<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/quarto-contrib/qrcodejs-v1.0.0/qrcode.js"></script><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <meta name="author" content="è€é®‘ä¼¯">
  <title>PowerShell TDD èµ·æ­¥èµ°</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-423d414d36ce366a9d05f36d06304417.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <style>
  .center-xy {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translateY(-50%), translateX(-50%);
  transform: translateY(-50%), translateX(-50%);
  }
  .text-center {
  text-align: center;
  }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">PowerShell TDD èµ·æ­¥èµ°</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
è€é®‘ä¼¯ 
</div>
</div>
</div>

</section>
<section id="agenda" class="title-slide slide level1 center">
<h1>Agenda</h1>
<div class="columns">
<div class="column" style="width:80%;">
<ul>
<li>Visual Studio Code å»ºç½® PowerShell TDD é–‹ç™¼ç’°å¢ƒ</li>
<li>PowerShell æ¸¬è©¦å·¥å…·æ¡†æ¶ Pesterä»‹ç´¹ã€ç‚ºæ—¢æœ‰ PowerShell scriptåŠ ä¸Šå¯åŸ·è¡Œæ¸¬è©¦æ¡ˆä¾‹</li>
<li>PowerShell + C# binary cmdletã€ASP.NET Core æ•´åˆ PowerShell Hosting Script çš„ TDD ç¯„ä¾‹</li>
</ul>
</div><div class="column" style="width:20%;">
<div id="" class="qrcode"></div>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":"220","text":"https://windperson.github.io/PowerShellTDD_GetStart-slide/#/title-slide","width":"220"});
  script.remove();
})();
</script>
    
<div class="text-center smaller">
<p><strong>Slide URL</strong></p>
</div>
</div></div>
</section>

<section>
<section id="visual-studio-code-å»ºç½®-powershell-tdd-é–‹ç™¼ç’°å¢ƒ" class="title-slide slide level1 center">
<h1>Visual Studio Code å»ºç½® PowerShell TDD é–‹ç™¼ç’°å¢ƒ</h1>

</section>
<section id="vscode-as-powershell-tdd-ide" class="slide level2">
<h2>VSCode as PowerShell TDD IDE</h2>
<ul>
<li>å»ºè­°ä½¿ç”¨ <a href="http://code.visualstudio.com"><strong>VSCode</strong>(Visual Studio Code)</a> å®‰è£å®˜æ–¹ <a href="http://github.com/PowerShell/vscode-powershell">PowerShell Extension</a> + C# ç›¸é—œé–‹ç™¼æ“´å……å¥—ä»¶ ä½œç‚º PowerShell é–‹ç™¼ç’°å¢ƒ:
<ul>
<li>å®˜æ–¹å®‰è£è¨­å®šæ•™å­¸ï¼š <br>
<ul>
<li><a href="https://code.visualstudio.com/docs/languages/powershell" class="uri">https://code.visualstudio.com/docs/languages/powershell</a></li>
<li><a href="https://learn.microsoft.com/powershell/scripting/dev-cross-plat/vscode/using-vscode" class="uri">https://learn.microsoft.com/powershell/scripting/dev-cross-plat/vscode/using-vscode</a></li>
</ul></li>
<li>æä¾› PowerShell çš„ Syntax Highlightingã€Outline Viewã€Go to Definitionã€IntelliSenseã€Code Lensã€Run &amp; Debug Pester test code ç­‰åŠŸèƒ½ã€‚</li>
<li>å¯ debug PowerShell + C# binary cmdlet çš„æ··åˆå°ˆæ¡ˆã€‚</li>
</ul></li>
</ul>
</section>
<section id="vscode-as-powershell-tdd-ide-1" class="slide level2 scrollable">
<h2>VSCode as PowerShell TDD IDE</h2>
<ul>
<li>ç‚ºäº†æœ‰ä¸€å€‹ä¹¾æ·¨ï¼†å¿«é€Ÿçš„TDDé–‹ç™¼ç’°å¢ƒï¼Œå»ºè­°ä½¿ç”¨<a href="http://code.visualstudio.com/docs/editor/portable">Portable ç‰ˆæœ¬çš„ VSCode</a>ï¼Œä»¥å…åŒæ™‚å®‰è£å¤ªå¤šæ“´å……å¥—ä»¶æ¶ˆè€—è³‡æºã€‚ <img data-src="./01_IDE_Setup/pics/vscode_zip_version.png" class="quarto-figure quarto-figure-center" style="height:100.0%"></li>
<li>ä¸€å®šè¦å®‰è£çš„å¥—ä»¶å…¶å¯¦åªæœ‰ä¸‰å€‹(å»æ‰ Vim ğŸ˜†)ï¼š<br> (<a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csdevkit">C# Dev Kit</a>å¥—ä»¶éå…è²»ä¸”ç„¡æ³•åœ¨å°é–‰å…§ç¶²ç’°å¢ƒä½¿ç”¨) <img data-src="./01_IDE_Setup/pics/minimal_powershell_dev_extensions.png" class="quarto-figure quarto-figure-center"></li>
</ul>
</section>
<section id="example-vscode-environment" class="slide level2">
<h2>Example VSCode Environment</h2>
<p>ç”±æ–¼ .NET SDK æœƒæ ¹æ“šä½œæ¥­ç³»çµ±ï¼†CPUæ¶æ§‹ä¸åŒè€Œæœ‰ä¸åŒçš„å®‰è£æ–¹å¼ï¼Œæä¾›ä»¥ä¸‹ç‰ˆæœ¬çš„ Portable VSCode + PowerShell Extension + C# ç›¸é—œé–‹ç™¼æ“´å……å¥—ä»¶ çš„ç¯„ä¾‹é–‹ç™¼ç’°å¢ƒï¼š</p>
<ul>
<li><a href="https://github.com/windperson/vscode_win32x64_pwsh">Windows 10 &amp; 11 (x64)</a></li>
<li><a href="https://github.com/windperson/vscode_win32Arm64_pwsh">Windows 11 (ARM64)</a></li>
<li><a href="https://github.com/windperson/vscode_macOSARM64_pwsh">macOS (ARM 64)</a></li>
</ul>
</section>
<section id="example-vscode-environment---windowsx64" class="slide level2 smaller scrollable">
<h2>Example VSCode Environment - Windows(x64)</h2>
<p>é™¤äº†è¦æ‰‹å‹•é–‹å•ŸWindowsã€é–‹ç™¼è€…æ¨¡å¼ã€è¨­å®šä»¥åŠå°‡åŒæ†çš„ .NET SDK çš„åŸ·è¡Œæª”è·¯å¾‘åˆ°ç’°å¢ƒè®Šæ•¸ä¹‹å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä½¿ç”¨ Portable ç‰ˆæœ¬çš„é–‹ç™¼ç’°å¢ƒï¼š</p>
<ul>
<li>Windows ç’°å¢ƒçš„ relative symbolic link éœ€è¦å•Ÿç”¨é–‹ç™¼è€…æ¨¡å¼æ‰èƒ½è®“ PowerShell ä»¥ä¸éœ€ç®¡ç†å“¡æ¬Šé™çš„æ–¹å¼è¨­å®šã€‚ <img data-src="./01_IDE_Setup/pics/win10_developer_mode.png" class="quarto-figure quarto-figure-center"><br>
å¦å‰‡ç”šè‡³é€£Windowså…§å»ºçš„è§£å£“ç¸®åŠŸèƒ½éƒ½æœƒè¢«æ‹’çµ•å­˜å–ã€‚ <img data-src="./01_IDE_Setup/pics/symbolic_link_no_permission.png" class="quarto-figure quarto-figure-center"></li>
<li>.NET SDK çš„åŸ·è¡Œè·¯å¾‘å»ºè­°ä»¥ <strong>DOTNET_ROOT</strong> ç’°å¢ƒè®Šæ•¸è¨­å®šï¼Œä»¥ä¾¿æ–¼åˆ‡æ›ä¸åŒç‰ˆæœ¬ <strong>dotnet</strong> æŒ‡ä»¤<br>ï¼ˆä½¿ç”¨ç³»çµ±å®‰è£çš„ .NET SDK 8.0 ä¹ŸğŸ‘ŒğŸ†—ï¼‰ã€‚ <img data-src="./01_IDE_Setup/pics/set_dotnet_root_env-Windows_x64.png" class="quarto-figure quarto-figure-center"> <img data-src="./01_IDE_Setup/pics/set_path_env_include_dotnet_root-Windows_x64.png" class="quarto-figure quarto-figure-center"></li>
</ul>
</section>
<section id="example-vscode-environment---windowsx64-1" class="slide level2 smaller scrollable">
<h2>Example VSCode Environment - Windows(x64)</h2>
<p>é–‹ç™¼ç’°å¢ƒçš„æª”æ¡ˆç›®éŒ„æ¶æ§‹:</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./01_IDE_Setup/pics/portable_vscode_ide_files.png" class="quarto-figure quarto-figure-center" style="width:80.0%;height:80.0%"></p>
</figure>
</div>
<ul>
<li><p>ä½¿ç”¨ç¨ç«‹çš„ PowerShell Module ç›®éŒ„é¿å…å› ç‚ºä¸åŒå°ˆæ¡ˆéœ€è¦çš„å„ç¨®ç‰ˆæœ¬ PowerShell Module äº’è¡ï¼Œæˆ–æ˜¯å’Œç³»çµ±å±¤ç´šçš„ Module æ··æ·†ã€‚</p></li>
<li><p>å› æ­¤è¦åœ¨ PowerShell Module ç›®éŒ„å…§ä¸‹è¼‰ä¸¦å®‰è£ <a href="https://github.com/JustinGrote/ModuleFast">â€œModuleFastâ€</a> é€™å€‹å·¥å…·å‹ PowerShell Moduleï¼Œç”¨æ­¤å‘½ä»¤åˆ—å·¥å…·å®‰è£ PowerShell Module æ™‚å¯ä¸‹æŒ‡ä»¤æŒ‡å®šå®‰è£ä¾†æºã€å®‰è£ä½ç½®ã€æ¨¡çµ„ç‰ˆæœ¬ã€‚</p></li>
</ul>
<p>ä¾‹å¦‚ä»¥ä¸‹ç¯„ä¾‹ï¼Œå¾ nuget.org å®‰è£ Pester v5.6.1 ç‰ˆæœ¬åˆ° D:_portable_modules ç›®éŒ„ï¼š</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource powershell number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb1-1"><a href=""></a> @<span class="op">{</span>ModuleName<span class="op">=</span><span class="st">'Pester'</span><span class="op">;</span>ModuleVersion<span class="op">=</span><span class="st">'5.6.1'</span><span class="op">}</span> <span class="op">|</span> Install-ModuleFast <span class="op">-</span>Source api<span class="op">.</span><span class="fu">nuget</span><span class="op">.</span><span class="fu">org</span><span class="op">/</span>v3 <span class="op">-</span>Destination D<span class="op">:</span>\vscode_portable\pwsh_modules</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br> å¦å¤–é‚„æœ‰ä¸€å€‹å¥½ç”¨çš„é–‹ç™¼ç”¨ PowerShell æŒ‡ä»¤åˆ—å·¥å…·æ¨¡çµ„ <a href="http://github.com/deadlydog/PowerShell.dumPS">PowerShell.dumPS</a>ï¼Œå¯ä»¥ç”¨ä¾†åœ¨ VSCode ä¸­æ–·é»é™¤éŒ¯æ™‚ï¼Œä½¿ç”¨ Debug Console å¿«é€ŸæŸ¥çœ‹ PowerShell ç‰©ä»¶çš„é¡åˆ¥ã€å±¬æ€§å€¼è³‡è¨Šã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource powershell number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb2-1"><a href=""></a><span class="va">$AnyObject</span> <span class="op">|</span> Out-Dump</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./01_IDE_Setup/pics/demo_PowerShell.dumPS.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</section>
<section id="example-vscode-environment---windowsx64-2" class="slide level2 smaller scrollable">
<h2>Example VSCode Environment - Windows(x64)</h2>
<p>åœ¨ pwsh-scripts ç›®éŒ„çš„é–‹ç™¼ç’°å¢ƒè¨­å®šç”¨ script æª”æ¡ˆï¼š</p>
<ul>
<li><p><strong>PSScriptAnalyzerSettings.psd1</strong><br>ç”¨ä¾†æ§åˆ¶ VSCode å®˜æ–¹ PowerShell Extension å…§å»ºçš„ <a href="https://learn.microsoft.com/powershell/utility-modules/psscriptanalyzer/using-scriptanalyze">PSScriptAnalyzer(PowerShell Syntax Linter)</a> è¨­å®šæª”ã€‚</p></li>
<li><p><strong>Set-PwshTools.ps1</strong><br>æ›¿ä»£ PowerShell Profile çš„è¨­å®šæª”ï¼Œç”¨ä¾†è¨­å®š VSCode æ•´åˆçµ‚ç«¯æ©Ÿä¸­ PowerShell å‘½ä»¤åˆ—çš„è‡ªå‹•å®ŒæˆåŠŸèƒ½ç›¸é—œè¨­å®šä»¥åŠæ·»åŠ ä¸€äº›é¡ä¼¼ Unix ç’°å¢ƒçš„æª”æ¡ˆå‘½ä»¤ã€‚</p>
<div class="sourceCode" id="annotated-cell-20"><pre class="sourceCode numberSource json code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode json"><span id="annotated-cell-20-1"><a href="#annotated-cell-20-1"></a>  <span class="er">"terminal.integrated.profiles.windows":</span> <span class="fu">{</span></span>
<span id="annotated-cell-20-2"><a href="#annotated-cell-20-2"></a>    <span class="dt">"PowerShell"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="annotated-cell-20-3"><a href="#annotated-cell-20-3"></a>      <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"Bundled pwsh"</span><span class="fu">,</span></span>
<span id="annotated-cell-20-4"><a href="#annotated-cell-20-4"></a>      <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"D:</span><span class="ch">\\</span><span class="st">vscode_portable</span><span class="ch">\\</span><span class="st">PowerShell-x64</span><span class="ch">\\</span><span class="st">pwsh.exe"</span><span class="fu">,</span></span>
<span id="annotated-cell-20-5"><a href="#annotated-cell-20-5"></a>      <span class="dt">"args"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="annotated-cell-20-6"><a href="#annotated-cell-20-6"></a>        <span class="st">"-nol"</span><span class="ot">,</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-20-7" class="code-annotation-target"><a href="#annotated-cell-20-7"></a>        <span class="st">"-nop"</span><span class="ot">,</span></span>
<span id="annotated-cell-20-8"><a href="#annotated-cell-20-8"></a>        <span class="st">"-noe"</span><span class="ot">,</span></span>
<span id="annotated-cell-20-9"><a href="#annotated-cell-20-9"></a>        <span class="st">"-ex"</span><span class="ot">,</span></span>
<span id="annotated-cell-20-10"><a href="#annotated-cell-20-10"></a>        <span class="st">"RemoteSigned"</span><span class="ot">,</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-20-11" class="code-annotation-target"><a href="#annotated-cell-20-11"></a>        <span class="st">"-Command"</span><span class="ot">,</span></span>
<span id="annotated-cell-20-12"><a href="#annotated-cell-20-12"></a>        <span class="st">"Invoke-expression </span><span class="ch">\"</span><span class="st">. D:</span><span class="ch">\\</span><span class="st">vscode_portable</span><span class="ch">\\</span><span class="st">pwsh-scripts</span><span class="ch">\\</span><span class="st">Set-PwshTools.ps1</span><span class="ch">\"</span><span class="st">"</span></span>
<span id="annotated-cell-20-13"><a href="#annotated-cell-20-13"></a>      <span class="ot">]</span></span>
<span id="annotated-cell-20-14"><a href="#annotated-cell-20-14"></a>    <span class="fu">}</span></span>
<span id="annotated-cell-20-15"><a href="#annotated-cell-20-15"></a>  <span class="fu">}</span><span class="er">,</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="7" data-code-annotation="1">ä½¿ç”¨ <code>-nop</code> åƒæ•¸é¿å…åŸ·è¡Œç›®å‰ç³»çµ±/ä½¿ç”¨è€…ç­‰ç´šçš„ PowerShell Profile è¨­å®šæª”</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="11,12" data-code-annotation="2">åŸ·è¡Œ <code>Invoke-Expression ". D:\vscode_portable\pwsh-scripts\Set-PwshTools.ps1"</code> ä¾†æ›¿ä»£ã€‚</span>
</dd>
</dl></li>
<li><p><strong>Update-SymLinks.ps1</strong><br>ç”¨ä¾†æ›´æ–°/æ¢å¾©å…©å€‹ symbolic link æª”æ¡ˆï¼1. æ ¹ç›®éŒ„çš„ VSCode ä¸»ç¨‹å¼å•Ÿå‹•é€£çµ 2. VSCode å¯æ”œæ¨¡å¼è¨­å®šçš„ä½¿ç”¨è€…è³‡æ–™æª”æ¡ˆç›®éŒ„é€£çµã€‚<br>(Windows 10 symbolic link æœƒå› æ¬ç§»åˆ°ä¸åŒç£ç¢Ÿæ©Ÿ/é›»è…¦è€Œå¤±æ•ˆ) <img data-src="./01_IDE_Setup/pics/update_symbolic_link-Windows_x64.png" class="quarto-figure quarto-figure-center"></p></li>
</ul>
</section></section>
<section>
<section id="powershell-æ¸¬è©¦å·¥å…·æ¡†æ¶-pester-ä»‹ç´¹" class="title-slide slide level1 center">
<h1>PowerShell æ¸¬è©¦å·¥å…·æ¡†æ¶ Pester ä»‹ç´¹</h1>

</section>
<section id="pester---powershell-test-framework" class="slide level2">
<h2>Pester - PowerShell Test Framework</h2>
<ul>
<li><a href="http://pester.dev">Pester</a> æ˜¯ä¸€å€‹ PowerShell çš„å…¨å®¶æ¡¶æ¸¬è©¦æ¡†æ¶ï¼Œå¯ä»¥ç”¨ä¾†æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ã€åŸ·è¡Œæ¸¬è©¦æ¡ˆä¾‹ã€ç”¢ç”Ÿæ¸¬è©¦å ±å‘Šã€‚</li>
<li>æä¾› <a href="http://pester.dev/docs/assertions/">Assertion Syntax</a> / <a href="http://pester.dev/docs/usage/mocking">Mock</a> / <a href="http://pester.dev/docs/commands/Invoke-Pester">Test Runner</a> / <a href="http://pester.dev/docs/usage/code-coverage">Code Coverage</a> ç­‰é€²è¡Œæ¸¬è©¦é©…å‹•é–‹ç™¼æ™‚éœ€è¦çš„åŠŸèƒ½ã€‚</li>
<li>æä¾›æ¸¬è©¦ç”¨è™›æ“¬ç£ç¢Ÿ <a href="http://pester.dev/docs/usage/testdrive"><code>TestDrive:</code></a> /<br>è™›æ“¬ Windows Registry <a href="http://pester.dev/docs/usage/testregistry"><code>TestRegistry:</code></a> çš„åŸ·è¡Œç’°å¢ƒéš”é›¢åŠŸèƒ½ï¼Œæ–¹ä¾¿é€²è¡Œæ¸¬è©¦ç¨‹å¼ç¢¼æ’°å¯«ã€‚</li>
<li>è·Ÿ VSCode PowerShell Extension æ•´åˆï¼Œå¯åœ¨ <a href="http://pester.dev/docs/usage/vscode">VSCode çš„ Code Lensä¸­ç›´æ¥åŸ·è¡Œ/é™¤éŒ¯ç‰¹å®šçš„å–®ä¸€ Pester æ¸¬è©¦æ¡ˆä¾‹</a>ã€‚</li>
<li>PowerShell å®˜æ–¹ä¹Ÿä½¿ç”¨æ­¤æ¸¬è©¦æ¡†æ¶ä¾†å¯«æ¸¬è©¦æ¡ˆä¾‹ã€‚<br><a href="https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/WritingPesterTests.md" class="uri">https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/WritingPesterTests.md</a></li>
</ul>
</section>
<section id="pester-æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼é‡é»" class="slide level2 small scrollable">
<h2>Pester æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼é‡é»</h2>
<ul>
<li>ä»¥ <code>Describe</code> ä¾†æè¿°æ¸¬è©¦æ¡ˆä¾‹çš„ä¸»é¡Œï¼Œä»¥ <code>Context</code> ä¾†æè¿°æ¸¬è©¦æ¡ˆä¾‹çš„å­ä¸»é¡Œï¼Œä»¥ <code>It</code> ä¾†æè¿°æ¸¬è©¦æ¡ˆä¾‹çš„æ–·è¨€(Test Case)ã€‚</li>
<li>é›–ç„¶ Pester è‡ªå·±é è¨­è¡Œç‚ºæ˜¯å»æœå°‹åŸ·è¡Œç›®éŒ„ä¸‹ä»¥ <code>.Tests.ps1</code> æª”æ¡ˆåçµå°¾çš„ PowerShell Script æª”æ¡ˆä½œç‚ºæ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼åŸ·è¡Œï¼Œä½†æ˜¯å¾—è‡ªè¡Œè™•ç†å¾…æ¸¬è©¦ PowerShell Script æª”æ¡ˆ( .ps1/.psm1 )çš„æ¨¡çµ„è¼‰å…¥å•é¡Œã€‚</li>
<li>é€é <a href="http://pester.dev/docs/usage/mocking"><code>Mock</code></a> ä¾†æ¨¡æ“¬å¤–éƒ¨ä¾è³´çš„PowerShellå‡½å¼å‘¼å«/åŸç”Ÿæ‡‰ç”¨ç¨‹å¼åŸ·è¡Œï¼Œä»¥é”åˆ°éš”é›¢æ¸¬è©¦çš„ç›®çš„ï¼š
<ul>
<li><code>Mock</code> æœƒåœ¨æ¸¬è©¦æ¡ˆä¾‹åŸ·è¡Œå‰å°‡åŸæœ¬çš„å‡½å¼/ç¨‹å¼æ›¿æ›æˆ Mock æ‰€å®šç¾©çš„è¡Œç‚ºï¼Œæ¸¬è©¦æ¡ˆä¾‹åŸ·è¡Œå®Œç•¢å¾Œå†é‚„åŸã€‚
<ul>
<li>Pester çš„ Mock åŠŸèƒ½åœ¨ PowerShell v7+ æ”¯æ´è¼ƒå¥½ï¼Œå»ºè­°æ¸¬è©¦æ¡ˆä¾‹çš„ script ç¨‹å¼ç¢¼å„˜é‡ç”¨ PowerShell v7+ çš„ç’°å¢ƒä¾†åŸ·è¡Œã€‚</li>
<li>Pester åº•å±¤ä½¿ç”¨ <a href="http://learn.microsoft.com/powershell/scripting/learn/shell/using-aliases">PowerShell Alias åŠŸèƒ½</a>å¯¦ç¾ Mock å‘½ä»¤å¯¦ä½œã€‚</li>
<li>ç•¶å®£å‘Š Mock æ™‚ï¼Œ<strong>è¦è“‹æ‰çš„ PowerShell Cmdlet/å‡½å¼å‘½ä»¤ å¿…é ˆå·²å­˜åœ¨æ–¼å¾…æ¸¬è©¦ç¨‹å¼ç¢¼çš„ Module Scope å…§ï¼Œå¦å‰‡ Pester æœƒç„¡æ³•è“‹æ‰ï¼Œè½‰è€Œæ‹‹å‡ºåŸ·è¡ŒéŒ¯èª¤ã€‚</strong></li>
<li>å®£å‘Šçš„ Mock åœ¨ä½¿ç”¨å‘½ä»¤çš„ç¨‹å¼ç¢¼æ‰€åœ¨çš„ Module <a href="http://learn.microsoft.com/powershell/module/microsoft.powershell.core/about/about_scopes">ä½œç”¨åŸŸ(Module Scope)</a> å…§æœ‰æ•ˆï¼Œè€Œéå…¨åŸŸæœ‰æ•ˆã€‚</li>
</ul></li>
<li><code>Mock</code> æœƒè¨˜éŒ„ Mock ç‰©ä»¶çš„å‘¼å«æ¬¡æ•¸ã€åƒæ•¸ã€å›å‚³å€¼ç­‰è³‡è¨Šï¼Œæ–¹ä¾¿æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹æ™‚æª¢æŸ¥ã€‚</li>
<li><code>Mock</code> ç„¡æ³•è“‹æ‰ä½¿ç”¨ binary cmdlet è¼‰å…¥çš„ C# Cmdlet å‡½å¼ï¼Œå› ç‚ºåŒåæ¨¡çµ„ä¸­çš„å‡½å¼å‘¼å«å„ªå…ˆé †åº <strong><em>C# &gt;&gt;&gt; PowerShell</em></strong>ã€‚</li>
</ul></li>
<li>é€é <code>TestDrive:</code> ä¾†å»ºç«‹è™›æ“¬ç£ç¢Ÿç©ºé–“ï¼Œä»¥é”åˆ°éš”é›¢æ¸¬è©¦çš„ç›®çš„ã€‚</li>
<li>é€é <code>TestRegistry:</code> ä¾†å»ºç«‹è™›æ“¬ Windows Registry ç©ºé–“ï¼Œä»¥é”åˆ°éš”é›¢æ¸¬è©¦çš„ç›®çš„ã€‚</li>
<li>å¿…è¦æ™‚å¯å»ºç«‹ Customer Pester Assertion ä»¥ä¾¿ç°¡åŒ–é©—è­‰æ¸¬è©¦çµæœçš„ç¨‹å¼ç¢¼å€å¡Šçš„æ’°å¯«ã€‚</li>
</ul>
</section>
<section id="pester-ç‚ºæ—¢æœ‰ç¨‹å¼æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼ç¯„ä¾‹" class="slide level2">
<h2>Pester ç‚ºæ—¢æœ‰ç¨‹å¼æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼ç¯„ä¾‹</h2>
<h3 id="demo"><strong><em>Demo</em></strong></h3>
<p><a href="http://github.com/windperson/DemoPester">ç¯„ä¾‹ç¨‹å¼ç¢¼ GitHub</a></p>
<ul>
<li>ç³»çµ±æ€§çš„åˆ¶å¼ Data-Driven æ¸¬è©¦æ¡ˆä¾‹æ¶æ§‹ä¾†é©—è­‰å„æ¨¡çµ„å‡½å¼çš„è¼¸å…¥åƒæ•¸åç¨±ã€å‹åˆ¥ã€å›å‚³å€¼ã€‚</li>
<li>ç”±æ–¼ PowerShell å°æ–¼ .ps1 &amp; .psm1 æ¨¡çµ„è¼‰å…¥æ©Ÿåˆ¶çš„ä¸åŒï¼Œæœƒé€ æˆæŸäº›å¾…æ¸¬æ¨¡çµ„çš„ç¨‹å¼ç¢¼å¯«æ³•ï¼Œå¾ˆä¸å®¹æ˜“æ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼ã€‚
<ul>
<li><code>InModuleScope</code> ä»¥ä¾¿åœ¨å¾…æ¸¬æ¨¡çµ„è¼‰å…¥æ™‚çš„ç’°å¢ƒè®Šæ•¸è¨­å®šè‡ªå®šç¾©é‚è¼¯(å¡å…¥å›ºå®šåƒæ•¸/Mock/Assertionç¨‹å¼ç¢¼)ã€‚</li>
<li>è—‰ç”±å…ˆå®£å‘Šä¸€äº› Dummy function ä¾†ã€å…ˆä½”ä½ã€ä»¥ä¾¿é †åˆ©é€²è¡Œå®£å‘Š MOck èªæ³•ï¼Œç„¶å¾Œå†è¼‰å…¥æ¨¡çµ„ä»¥ä¾¿é€²è¡Œæ¸¬è©¦ã€‚</li>
</ul></li>
<li>Pester Custom Assertion çš„æ’°å¯«åŠè¨»å†Šä½¿ç”¨ã€‚</li>
</ul>
</section>
<section id="ç³»çµ±æ€§åˆ¶å¼-data-driven-æ¸¬è©¦æ¡ˆä¾‹æ¶æ§‹é©—è­‰-æ¨¡çµ„å‡½å¼-è¼¸å…¥åƒæ•¸åç¨±å‹åˆ¥å›å‚³å‹åˆ¥" class="slide level2 smaller scrollable">
<h2>ç³»çµ±æ€§åˆ¶å¼ Data-Driven æ¸¬è©¦æ¡ˆä¾‹æ¶æ§‹é©—è­‰<br>æ¨¡çµ„å‡½å¼ è¼¸å…¥åƒæ•¸åç¨±/å‹åˆ¥/å›å‚³å‹åˆ¥</h2>
<p>é›–ç„¶ PowerShell æ˜¯ Strongly Typed Languageï¼Œä½†æ˜¯åœ¨å°ˆæ¡ˆå¯«å¤§å¯«è¤‡é›œæ™‚ï¼Œä»ç„¶éœ€è¦ä¸€äº›é©—è­‰æ©Ÿåˆ¶ä¾†ç¢ºå®šå±¤å±¤å‘¼å«å‡½å¼çš„è¼¸å…¥åƒæ•¸åç¨±ã€å‹åˆ¥ã€å›å‚³å€¼å‹åˆ¥æ˜¯å¦æ­£ç¢ºã€‚<br> ï¼ˆ é¿å…è·‘scriptæ™‚è¢«ä¸€å † <strong>Command/Parameter Not Found</strong> ææ­»ï¼‰</p>
<p>å…ˆèªªçµè«–ï¼š</p>
<blockquote>
<p>è—‰ç”±è‡ªè¡Œå®šç¾©å„²å­˜ key-value ç‰©ä»¶çš„ PowerShell é™£åˆ—ï¼Œ<br>æè¿°å‡½å¼çš„åç¨±ã€è¼¸å…¥åƒæ•¸ã€å›å‚³å€¼ï¼Œé€é Pester çš„æ¸¬è©¦æ¡ˆä¾‹ä¾†é©—è­‰è¼‰å…¥ä¹‹æ¨¡çµ„æœ‰é€™äº›å‡½å¼ã€‚</p>
</blockquote>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Demo1to1MappingTestModule\Production_test\ProductFeatures\MathFeatureModule\MathFeature.Tests.ps1</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="Demo1to1MappingTestModule\Production_test\ProductFeatures\MathFeatureModule\MathFeature.Tests.ps1" data-code-line-numbers="4-42"><pre class="sourceCode numberSource powershell ps1 number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb3-1"><a href=""></a>Describe <span class="st">"Math function API declaration"</span> <span class="op">-</span>Tag <span class="st">"MathFeature"</span><span class="op">,</span> <span class="st">"FunctionDeclaration"</span> <span class="op">{</span></span>
<span id="cb3-2"><a href=""></a>    BeforeDiscovery <span class="op">{</span></span>
<span id="cb3-3"><a href=""></a>        <span class="co">#region API definitions</span></span>
<span id="cb3-4"><a href=""></a>        <span class="va">$ApiDefinition</span> <span class="op">=</span> <span class="op">@(</span></span>
<span id="cb3-5"><a href=""></a>            @<span class="op">{</span></span>
<span id="cb3-6"><a href=""></a>                Name        <span class="op">=</span> <span class="st">'Invoke-Add'</span></span>
<span id="cb3-7"><a href=""></a>                CommandType <span class="op">=</span> <span class="op">[</span>System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">CommandTypes</span><span class="op">]::</span>Function<span class="op">;</span></span>
<span id="cb3-8"><a href=""></a>                Inputs      <span class="op">=</span> @<span class="op">{</span></span>
<span id="cb3-9"><a href=""></a>                    a <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-10"><a href=""></a>                    b <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-11"><a href=""></a>                <span class="op">}</span></span>
<span id="cb3-12"><a href=""></a>                Outputs     <span class="op">=</span> <span class="op">@([</span><span class="dt">int</span><span class="op">])</span></span>
<span id="cb3-13"><a href=""></a>            <span class="op">}</span></span>
<span id="cb3-14"><a href=""></a>            @<span class="op">{</span></span>
<span id="cb3-15"><a href=""></a>                Name        <span class="op">=</span> <span class="st">'Invoke-Sub'</span></span>
<span id="cb3-16"><a href=""></a>                CommandType <span class="op">=</span> <span class="op">[</span>System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">CommandTypes</span><span class="op">]::</span>Function<span class="op">;</span></span>
<span id="cb3-17"><a href=""></a>                Inputs      <span class="op">=</span> @<span class="op">{</span></span>
<span id="cb3-18"><a href=""></a>                    a <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-19"><a href=""></a>                    b <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-20"><a href=""></a>                <span class="op">}</span></span>
<span id="cb3-21"><a href=""></a>                Outputs     <span class="op">=</span> <span class="op">@([</span><span class="dt">int</span><span class="op">])</span></span>
<span id="cb3-22"><a href=""></a>            <span class="op">}</span></span>
<span id="cb3-23"><a href=""></a>            @<span class="op">{</span></span>
<span id="cb3-24"><a href=""></a>                Name        <span class="op">=</span> <span class="st">'Invoke-Mul'</span></span>
<span id="cb3-25"><a href=""></a>                CommandType <span class="op">=</span> <span class="op">[</span>System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">CommandTypes</span><span class="op">]::</span>Function<span class="op">;</span></span>
<span id="cb3-26"><a href=""></a>                Inputs      <span class="op">=</span> @<span class="op">{</span></span>
<span id="cb3-27"><a href=""></a>                    a <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-28"><a href=""></a>                    b <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-29"><a href=""></a>                <span class="op">}</span></span>
<span id="cb3-30"><a href=""></a>                Outputs     <span class="op">=</span> <span class="op">@([</span><span class="dt">int</span><span class="op">])</span></span>
<span id="cb3-31"><a href=""></a>            <span class="op">}</span></span>
<span id="cb3-32"><a href=""></a>            @<span class="op">{</span></span>
<span id="cb3-33"><a href=""></a>                Name        <span class="op">=</span> <span class="st">'Invoke-Div'</span></span>
<span id="cb3-34"><a href=""></a>                CommandType <span class="op">=</span> <span class="op">[</span>System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">CommandTypes</span><span class="op">]::</span>Function<span class="op">;</span></span>
<span id="cb3-35"><a href=""></a>                Inputs      <span class="op">=</span> @<span class="op">{</span></span>
<span id="cb3-36"><a href=""></a>                    a <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-37"><a href=""></a>                    b <span class="op">=</span> <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-38"><a href=""></a>                <span class="op">}</span></span>
<span id="cb3-39"><a href=""></a>                Outputs     <span class="op">=</span> <span class="op">@([</span><span class="dt">int</span><span class="op">])</span></span>
<span id="cb3-40"><a href=""></a>            <span class="op">}</span></span>
<span id="cb3-41"><a href=""></a>        <span class="op">)</span></span>
<span id="cb3-42"><a href=""></a>        <span class="co">#endregion</span></span>
<span id="cb3-43"><a href=""></a>    <span class="op">}</span></span>
<span id="cb3-44"><a href=""></a>    BeforeAll <span class="op">{</span></span>
<span id="cb3-45"><a href=""></a>        <span class="op">.</span> <span class="op">(</span><span class="fu">Resolve-Path</span> <span class="va">$UtiltiyModulePath</span>\VerifyPsDefApi<span class="op">.</span><span class="fu">ps1</span><span class="op">)</span></span>
<span id="cb3-46"><a href=""></a>    <span class="op">}</span></span>
<span id="cb3-47"><a href=""></a></span>
<span id="cb3-48"><a href=""></a>    It <span class="st">"Should have API </span><span class="ch">`'</span><span class="st">&lt;Name&gt;</span><span class="ch">`'</span><span class="st"> defined in ApiDefinition"</span> <span class="op">-</span>ForEach <span class="va">$ApiDefinition</span> <span class="op">{</span></span>
<span id="cb3-49"><a href=""></a>        VerifyApiDefinition <span class="op">-</span>Name <span class="va">$Name</span> <span class="op">-</span>CommandType <span class="va">$CommandType</span></span>
<span id="cb3-50"><a href=""></a>    <span class="op">}</span></span>
<span id="cb3-51"><a href=""></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>åŸç†æ˜¯ä½¿ç”¨ <a href="http://learn.microsoft.com/powershell/module/microsoft.powershell.core/get-command"><code>Get-Command</code></a> Cmdlet ä¾†å–å¾—å‡½å¼çš„ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.commandinfo">CommandInfo</a> ç‰©ä»¶ï¼Œå†é€é Pester çš„å„é …å±¬æ€§ä¹‹æ¸¬è©¦æ¡ˆä¾‹ä¾†é©—è­‰å„é …è³‡è¨Šï¼š</p>
<p><em>Step 1</em>: é©—è­‰æ­¤å‡½å¼æ˜¯å¦å­˜åœ¨æ–¼ç›®å‰å¯ä½¿ç”¨çš„PowerShellæ¨¡çµ„ä¹‹ä¸­ã€‚</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Demo1to1MappingTestModule\Production_test\VerifyPsDefApi.ps1</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-4" data-filename="Demo1to1MappingTestModule\Production_test\VerifyPsDefApi.ps1"><pre class="sourceCode powershell ps1 code-annotation-code code-with-copy code-annotated"><code class="sourceCode powershell"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> VerifyApiType<span class="op">()</span> <span class="op">{</span></span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">param</span><span class="op">(</span></span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span><span class="dt">string</span><span class="op">]</span> <span class="va">$Name</span><span class="op">,</span></span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">CommandTypes</span><span class="op">]</span> <span class="va">$CommandType</span> <span class="op">=</span> <span class="op">[</span>System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">CommandTypes</span><span class="op">]::</span>Function</span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">Process</span> <span class="op">{</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-4-8" class="code-annotation-target"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">$targetExists</span> <span class="op">=</span> <span class="fu">Get-Command</span> <span class="op">-</span>Name <span class="va">$Name</span> <span class="op">-</span>CommandType <span class="va">$CommandType</span> <span class="op">-</span>ErrorAction SilentlyContinue</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$targetExists</span> <span class="op">|</span> Should <span class="op">-Not</span> <span class="op">-</span>BeNullOrEmpty</span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$targetExists</span></span>
<span id="annotated-cell-4-11"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-4-12"><a href="#annotated-cell-4-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="8,9" data-code-annotation="1">ä½¿ç”¨ <code>Get-Command</code> Cmdlet ä¾†å–å¾—å‡½å¼çš„åƒæ•¸è³‡è¨Š CommandInfo ç‰©ä»¶ï¼Œç„¶å¾Œé€é Pester çš„æ¸¬è©¦æ¡ˆä¾‹ç¢ºèªç‰©ä»¶å­˜åœ¨ï¼Œå¦å‰‡ test failedã€‚</span>
</dd>
</dl>
<p><em>Step 2</em>: é©—è­‰æ­¤å‡½å¼çš„è¼¸å…¥åƒæ•¸åç¨±ã€å‹åˆ¥æ˜¯å¦æ­£ç¢ºã€‚</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Demo1to1MappingTestModule\Production_test\VerifyPsDefApi.ps1</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="Demo1to1MappingTestModule\Production_test\VerifyPsDefApi.ps1" data-code-line-numbers="18,23,27,28"><pre class="sourceCode numberSource powershell ps1 number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb4-1"><a href=""></a><span class="kw">function</span> VerifyApiInputParameters <span class="op">{</span></span>
<span id="cb4-2"><a href=""></a>    <span class="kw">param</span><span class="op">(</span></span>
<span id="cb4-3"><a href=""></a>        <span class="op">[</span>ValidateNotNull<span class="op">()]</span></span>
<span id="cb4-4"><a href=""></a>        <span class="op">[</span>System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">CommandInfo</span><span class="op">]</span></span>
<span id="cb4-5"><a href=""></a>        <span class="va">$commandInfo</span><span class="op">,</span></span>
<span id="cb4-6"><a href=""></a>        <span class="op">[</span>System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Hashtable</span><span class="op">]</span><span class="va">$designedParameters</span></span>
<span id="cb4-7"><a href=""></a>    <span class="op">)</span></span>
<span id="cb4-8"><a href=""></a>    <span class="co"># Note: since PowerShell's built-in Hashtable is case insensitive, we can't use it to exactly check function parameters</span></span>
<span id="cb4-9"><a href=""></a>    <span class="va">$parameterTable</span> <span class="op">=</span> <span class="fu">New-Object</span> <span class="st">'System.Collections.Hashtable'</span></span>
<span id="cb4-10"><a href=""></a>    <span class="cf">foreach</span> <span class="op">(</span><span class="va">$key</span> <span class="kw">in</span> <span class="va">$designedParameters</span><span class="op">.</span><span class="fu">Keys</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-11"><a href=""></a>        <span class="va">$parameterTable</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="va">$key</span><span class="op">,</span> <span class="va">$designedParameters</span><span class="op">[</span><span class="va">$key</span><span class="op">])</span></span>
<span id="cb4-12"><a href=""></a>    <span class="op">}</span></span>
<span id="cb4-13"><a href=""></a></span>
<span id="cb4-14"><a href=""></a>    <span class="va">$cmdletBuiltInParameters</span> <span class="op">=</span></span>
<span id="cb4-15"><a href=""></a>    <span class="op">@(</span><span class="st">'Verbose'</span><span class="op">,</span> <span class="st">'Debug'</span><span class="op">,</span> <span class="st">'ErrorAction'</span><span class="op">,</span> <span class="st">'ErrorVariable'</span><span class="op">,</span> <span class="st">'InformationAction'</span><span class="op">,</span> <span class="st">'InformationVariable'</span><span class="op">,</span> <span class="st">'WarningAction'</span><span class="op">,</span> <span class="st">'WarningVariable'</span><span class="op">,</span> <span class="st">'OutBuffer'</span><span class="op">,</span> <span class="st">'OutVariable'</span><span class="op">,</span> <span class="st">'PipelineVariable'</span><span class="op">,</span> <span class="st">'ProgressAction'</span><span class="op">,</span></span>
<span id="cb4-16"><a href=""></a>        <span class="st">'WhatIf'</span><span class="op">,</span> <span class="st">'Confirm'</span><span class="op">)</span></span>
<span id="cb4-17"><a href=""></a></span>
<span id="cb4-18"><a href=""></a>    <span class="cf">foreach</span> <span class="op">(</span><span class="va">$parameter</span> <span class="kw">in</span> <span class="va">$commandInfo</span><span class="op">.</span><span class="fu">Parameters</span><span class="op">.</span><span class="fu">Values</span><span class="op">.</span><span class="fu">GetEnumerator</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb4-19"><a href=""></a>        <span class="va">$parameterName</span> <span class="op">=</span> <span class="va">$parameter</span><span class="op">.</span><span class="fu">Name</span></span>
<span id="cb4-20"><a href=""></a>        <span class="cf">if</span> <span class="op">(</span> <span class="va">$commandInfo</span><span class="op">.</span><span class="fu">CmdletBinding</span> <span class="op">-and</span> <span class="va">$cmdletBuiltInParameters</span> <span class="op">-contains</span> <span class="va">$parameterName</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-21"><a href=""></a>            <span class="cf">continue</span></span>
<span id="cb4-22"><a href=""></a>        <span class="op">}</span></span>
<span id="cb4-23"><a href=""></a>        <span class="va">$parameterTable</span><span class="op">.</span><span class="fu">ContainsKey</span><span class="op">(</span><span class="va">$parameterName</span><span class="op">)</span> <span class="op">|</span> Should <span class="op">-</span>Be <span class="va">$true</span> <span class="op">-</span>Because <span class="st">"Parameter '</span><span class="va">$parameterName</span><span class="st">' should be exist"</span></span>
<span id="cb4-24"><a href=""></a>        <span class="va">$expectedType</span> <span class="op">=</span> <span class="va">$parameterTable</span><span class="op">[</span><span class="va">$parameterName</span><span class="op">]</span></span>
<span id="cb4-25"><a href=""></a>        <span class="co"># We compare type by its full name string, not rely on Pester's -BeOfType assertion</span></span>
<span id="cb4-26"><a href=""></a>        <span class="co"># see https://github.com/pester/Pester/issues/1315#issuecomment-756700291</span></span>
<span id="cb4-27"><a href=""></a>        <span class="va">$parameterTypeName</span> <span class="op">=</span> <span class="va">$parameter</span><span class="op">.</span><span class="fu">ParameterType</span><span class="op">.</span><span class="fu">FullName</span></span>
<span id="cb4-28"><a href=""></a>        <span class="va">$parameterTypeName</span> <span class="op">|</span> Should <span class="op">-</span>Be <span class="va">$expectedType</span><span class="op">.</span><span class="fu">ToString</span><span class="op">()</span> <span class="op">-</span>Because <span class="st">"Parameter '</span><span class="ch">`$</span><span class="va">$parameterName</span><span class="st">' should be of type '</span><span class="va">$expectedType</span><span class="st">'"</span></span>
<span id="cb4-29"><a href=""></a>    <span class="op">}</span></span>
<span id="cb4-30"><a href=""></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pester-mock-åŠŸèƒ½åœ¨-inmodulescope-çš„æ•æ·ä½¿ç”¨" class="slide level2 smaller scrollable">
<h2>Pester Mock åŠŸèƒ½åœ¨ InModuleScope çš„<strong><em>æ•æ·</em></strong>ä½¿ç”¨</h2>
<p>åœ¨æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼æ™‚ï¼Œæœ‰æ™‚å€™æœƒé‡åˆ°å¾…æ¸¬è©¦çš„ PowerShell Script æª”æ¡ˆä¸­çš„å‡½å¼å‘¼å«ï¼Œæœƒä¾è³´æ–¼å…¶ä»–å‡½å¼çš„å›å‚³å€¼ï¼Œé€™æ™‚å€™å°±éœ€è¦ä½¿ç”¨ Pester çš„ Mock åŠŸèƒ½ä¾†æ¨¡æ“¬å¤–éƒ¨å‡½å¼çš„å›å‚³å€¼ã€‚ è€Œå®šç¾©åœ¨æ¨¡çµ„å…§ä½†æ²’æœ‰ export çš„å‡½å¼ï¼Œå¤–ç•Œæ‘¸ä¸åˆ°ï¼Œé€™æ™‚å€™å°±éœ€è¦ä½¿ç”¨ <code>InModuleScope</code> å€å¡ŠåŠŸèƒ½ä¾†æ­£ç¢ºå®šç¾©è¦æ“ä½œçš„å…§éƒ¨å‡½å¼ Mockã€‚</p>
<p>ä¾‹å¦‚ä»¥ä¸‹å¾…æ¸¬ PowerShell Script æª”æ¡ˆï¼š</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>DemoScope\DemoUseAndRemoveMock\MyScript.psm1</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="DemoScope\DemoUseAndRemoveMock\MyScript.psm1" data-code-line-numbers="1-6,14"><pre class="sourceCode numberSource powershell ps1 number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb5-1"><a href=""></a><span class="kw">function</span> Get-CurrentTime <span class="op">{</span></span>
<span id="cb5-2"><a href=""></a>    <span class="kw">param</span><span class="op">()</span></span>
<span id="cb5-3"><a href=""></a>    <span class="va">$output</span> <span class="op">=</span> <span class="op">(</span><span class="fu">Get-Date</span><span class="op">).</span><span class="fu">ToString</span><span class="op">()</span></span>
<span id="cb5-4"><a href=""></a>    <span class="fu">Write-Information</span> <span class="op">-</span>MessageData <span class="st">"In Real Get-CurrentTime() function, </span><span class="ch">`$</span><span class="st">output=</span><span class="va">$output</span><span class="st">"</span> <span class="op">-</span>InformationAction <span class="cf">Continue</span></span>
<span id="cb5-5"><a href=""></a>    <span class="cf">return</span> <span class="va">$output</span></span>
<span id="cb5-6"><a href=""></a><span class="op">}</span></span>
<span id="cb5-7"><a href=""></a></span>
<span id="cb5-8"><a href=""></a><span class="kw">function</span> MyDateTime <span class="op">{</span></span>
<span id="cb5-9"><a href=""></a>    <span class="kw">param</span><span class="op">()</span></span>
<span id="cb5-10"><a href=""></a>    <span class="va">$time</span> <span class="op">=</span> Get-CurrentTime</span>
<span id="cb5-11"><a href=""></a>    <span class="cf">return</span> <span class="st">"The current time is </span><span class="va">$time</span><span class="st">"</span></span>
<span id="cb5-12"><a href=""></a><span class="op">}</span></span>
<span id="cb5-13"><a href=""></a></span>
<span id="cb5-14"><a href=""></a><span class="fu">Export-ModuleMember</span> MyDateTime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>ç”±æ–¼ <code>Get-CurrentTime</code> å‡½å¼æ²’æœ‰ exportï¼Œæ‰€ä»¥å¤–éƒ¨ç„¡æ³•ç›´æ¥å°å…¶ Mock ä»¥é¿å…æ¸¬è©¦çµæœæœƒæ¯æ¬¡åŸ·è¡Œæ™‚éƒ½ä¸åŒ<br>(<code>Get-CurrentTime</code> å…§éƒ¨æœ‰å‘¼å« <a href="https://learn.microsoft.com/powershell/module/microsoft.powershell.utility/get-date"><code>Get-Date</code></a> å–å¾—å¯¦éš›æ™‚é–“ï¼‰ï¼Œ<br>éœ€ä½¿ç”¨ <a href="https://pester.dev/docs/commands/InModuleScope"><code>InModuleScope</code></a> å€å¡Šåœ¨æ­£ç¢ºçš„PowerShell module ä½œç”¨åŸŸå…§éƒ¨å®šç¾© Mockã€‚</p>
</div>
</div>
</div>
<p>æ¸¬è©¦ç¨‹å¼ç¢¼ï¼š</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>DemoScope\DemoUseAndRemoveMock\MyScript.Tests.ps1</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-7" data-filename="DemoScope\DemoUseAndRemoveMock\MyScript.Tests.ps1"><pre class="sourceCode numberSource powershell ps1 code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode powershell"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1"></a>Describe <span class="st">"MyFunction"</span> <span class="op">{</span></span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2"></a>    BeforeAll <span class="op">{</span></span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3"></a>        <span class="fu">Import-Module</span> <span class="st">"</span><span class="va">$PSScriptRoot</span><span class="st">/MyScript.psm1"</span> <span class="op">-</span>Verbose <span class="op">-</span>Force</span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4"></a>    <span class="op">}</span></span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5"></a>    It <span class="st">"should return the mocked time"</span> <span class="op">{</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-7-6" class="code-annotation-target"><a href="#annotated-cell-7-6"></a>        InModuleScope MyScript <span class="op">{</span></span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7"></a>            Mock <span class="op">-</span>CommandName Get-CurrentTime <span class="op">-</span>MockWith <span class="op">{</span></span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8"></a>                <span class="va">$output</span> <span class="op">=</span> <span class="st">"2024-11-14 08:00:00"</span></span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9"></a>                <span class="fu">Write-Information</span> <span class="op">-</span>MessageData `</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10"></a>                    <span class="st">"In Mocked Get-CurrentTime(), output=</span><span class="va">$output</span><span class="st">"</span> `</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11"></a>                    <span class="op">-</span>InformationAction <span class="cf">Continue</span></span>
<span id="annotated-cell-7-12"><a href="#annotated-cell-7-12"></a>                <span class="cf">return</span> <span class="va">$output</span></span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13"></a>            <span class="op">}</span></span>
<span id="annotated-cell-7-14"><a href="#annotated-cell-7-14"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-7-15" class="code-annotation-target"><a href="#annotated-cell-7-15"></a>            <span class="va">$result</span> <span class="op">=</span> MyDateTime</span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16"></a>            <span class="va">$result</span> <span class="op">|</span> Should <span class="op">-</span>Be <span class="st">"The current time is 2024-11-14 08:00:00"</span></span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17"></a></span>
<span id="annotated-cell-7-18"><a href="#annotated-cell-7-18"></a>            <span class="co"># Remove mocked Get-CurrentTime Function</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-7-19" class="code-annotation-target"><a href="#annotated-cell-7-19"></a>            Remove-Alias Get-CurrentTime</span>
<span id="annotated-cell-7-20"><a href="#annotated-cell-7-20"></a>        <span class="op">}</span></span>
<span id="annotated-cell-7-21"><a href="#annotated-cell-7-21"></a></span>
<span id="annotated-cell-7-22"><a href="#annotated-cell-7-22"></a>        <span class="co"># Call the function again and check the result without the mock</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-7-23" class="code-annotation-target"><a href="#annotated-cell-7-23"></a>        <span class="va">$result</span> <span class="op">=</span> MyDateTime</span>
<span id="annotated-cell-7-24"><a href="#annotated-cell-7-24"></a>        <span class="va">$result</span> <span class="op">|</span> Should <span class="op">-Not</span> <span class="op">-</span>Be <span class="st">"The current time is 2024-11-14 08:00:00"</span></span>
<span id="annotated-cell-7-25"><a href="#annotated-cell-7-25"></a>    <span class="op">}</span></span>
<span id="annotated-cell-7-26"><a href="#annotated-cell-7-26"></a><span class="op">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="6,7,8,9,10,11,12,13" data-code-annotation="1">ä½¿ç”¨ <code>InModuleScope</code> å€å¡Šä¾†å®šç¾© Mock çš„å‡½å¼ï¼Œé€™æ¨£å°±å¯ä»¥åœ¨æ­£ç¢ºçš„ PowerShell module ä½œç”¨åŸŸå…§éƒ¨å®šç¾© Mockã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="15,16" data-code-annotation="2">åœ¨ <code>InModuleScope</code> å€å¡Šå…§éƒ¨åŸ·è¡Œå¾…æ¸¬è©¦çš„å‡½å¼ï¼Œä¸¦é©—è­‰å…¶å›å‚³å€¼æ˜¯å¦ç‚ºå‰ä¸€æ­¥é©Ÿ Mock çš„å›å‚³å€¼ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="19" data-code-annotation="3">ç§»é™¤ Mock çš„æ–¹æ³•å°±æ˜¯å‘¼å« <a href="http://learn.microsoft.com/powershell/module/microsoft.powershell.utility/remove-alias">Remove-Alias</a> Cmdletã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="23,24" data-code-annotation="4">ç§»é™¤ Mock å¾Œå†æ¬¡åŸ·è¡Œå¾…æ¸¬è©¦çš„å‡½å¼ï¼Œä¸¦é©—è­‰å…¶å›å‚³å€¼æ˜¯å¦æ­£ç¢ºã€‚</span>
</dd>
</dl>
<p>æ‰€ä»¥åœ¨æ›´ç‚ºè¤‡é›œçš„å¯¦éš›PowerShell Scriptå°ˆæ¡ˆæ¶æ§‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æŠ€å·§æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼æé«˜ code coverage rateã€‚</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>æ›´è¤‡é›œçš„å¦‚ï¼š<br><strong><em>è¼‰å…¥ .ps1 scriptæª”æ™‚æœƒç«‹åˆ»åŸ·è¡Œçš„å‡½å¼å¦‚ä½• Mock ï¼Ÿ</em></strong><br>åƒé–±æ­¤ç¯„ä¾‹å°ˆæ¡ˆçš„<br><a href="https://github.com/windperson/DemoPester/blob/main/Demo1to1MappingTestModule/Production_test/ProductFeatures/StringFeatureModule/FormatDateTime.Tests.ps1#L28"><code>Demo1to1MappingTestModule/Production_test/ProductFeatures/StringFeatureModule/FormatDateTime.Tests.ps1</code></a><br>æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼</p>
</div>
</div>
</div>
</section>
<section id="pester-custom-assertion" class="slide level2 small scrollable">
<h2>Pester Custom Assertion</h2>
<p>Pester æ²’æœ‰æä¾›æµ®é»æ•¸å€¼ç²¾ç¢ºåº¦æ¯”è¼ƒçš„ Assertion Cmdlet, æ‰€ä»¥å°±è‡ªå·±å‹•æ‰‹å¯«ä¸€å€‹ï¼š</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Demo1to1MappingTestModule\Production_test\ProductFeatures\MathFeatureModule\MathFeature.Tests.ps1</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-8" data-filename="Demo1to1MappingTestModule\Production_test\ProductFeatures\MathFeatureModule\MathFeature.Tests.ps1"><pre class="sourceCode powershell ps1 code-annotation-code code-with-copy code-annotated"><code class="sourceCode powershell"><a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-8-1" class="code-annotation-target"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Should-BeEqualWithPrecision<span class="op">(</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-8-2" class="code-annotation-target"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="dt">double</span><span class="op">]</span> <span class="va">$ActualValue</span><span class="op">,</span> <span class="op">[</span><span class="dt">double</span><span class="op">]</span> <span class="va">$ExpectValue</span><span class="op">,</span></span>
<span id="annotated-cell-8-3"><a href="#annotated-cell-8-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="dt">uint</span><span class="op">]</span> <span class="va">$Precision</span><span class="op">,</span></span>
<span id="annotated-cell-8-4"><a href="#annotated-cell-8-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="dt">switch</span><span class="op">]</span> <span class="va">$Negate</span><span class="op">,</span></span>
<span id="annotated-cell-8-5"><a href="#annotated-cell-8-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="dt">string</span><span class="op">]</span> <span class="va">$Because</span></span>
<span id="annotated-cell-8-6"><a href="#annotated-cell-8-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-8-7" class="code-annotation-target"><a href="#annotated-cell-8-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">$pass</span> <span class="op">=</span> <span class="op">[</span>math<span class="op">]::</span>Round<span class="op">(</span><span class="va">$ActualValue</span><span class="op">,</span> <span class="va">$Precision</span><span class="op">)</span> <span class="op">-eq</span> <span class="op">[</span>math<span class="op">]::</span>Round<span class="op">(</span><span class="va">$ExpectValue</span><span class="op">,</span> <span class="va">$Precision</span><span class="op">)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-8-8" class="code-annotation-target"><a href="#annotated-cell-8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="va">$Negate</span><span class="op">)</span> <span class="op">{</span></span>
<span id="annotated-cell-8-9"><a href="#annotated-cell-8-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$pass</span> <span class="op">=</span> <span class="op">-not</span> <span class="va">$pass</span></span>
<span id="annotated-cell-8-10"><a href="#annotated-cell-8-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-8-11"><a href="#annotated-cell-8-11" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="5" onclick="event.preventDefault();" href="">5</a><span id="annotated-cell-8-12" class="code-annotation-target"><a href="#annotated-cell-8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(-not</span> <span class="va">$pass</span><span class="op">)</span> <span class="op">{</span></span>
<span id="annotated-cell-8-13"><a href="#annotated-cell-8-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="va">$Negate</span><span class="op">)</span> <span class="op">{</span></span>
<span id="annotated-cell-8-14"><a href="#annotated-cell-8-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">$failureMessage</span> <span class="op">=</span></span>
<span id="annotated-cell-8-15"><a href="#annotated-cell-8-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Expected '</span><span class="va">$ActualValue</span><span class="st">' to not be equal to </span><span class="va">$ExpectValue</span><span class="op">$(</span><span class="cf">if</span><span class="op">(</span><span class="va">$Because</span><span class="op">)</span><span class="st"> { "</span> because <span class="va">$Because</span><span class="st">"})."</span></span>
<span id="annotated-cell-8-16"><a href="#annotated-cell-8-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="annotated-cell-8-17"><a href="#annotated-cell-8-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="annotated-cell-8-18"><a href="#annotated-cell-8-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">$failureMessage</span> <span class="op">=</span></span>
<span id="annotated-cell-8-19"><a href="#annotated-cell-8-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Expected '</span><span class="va">$ActualValue</span><span class="st">' to be equal to </span><span class="va">$ExpectValue</span><span class="op">$(</span><span class="cf">if</span><span class="op">(</span><span class="va">$Because</span><span class="op">)</span><span class="st"> { "</span> because <span class="va">$Because</span><span class="st">"})."</span></span>
<span id="annotated-cell-8-20"><a href="#annotated-cell-8-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="annotated-cell-8-21"><a href="#annotated-cell-8-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-8-22"><a href="#annotated-cell-8-22" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="6" onclick="event.preventDefault();" href="">6</a><span id="annotated-cell-8-23" class="code-annotation-target"><a href="#annotated-cell-8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">[</span>pscustomobject<span class="op">]</span>@<span class="op">{</span></span>
<span id="annotated-cell-8-24"><a href="#annotated-cell-8-24" aria-hidden="true" tabindex="-1"></a>        Succeeded      <span class="op">=</span> <span class="va">$pass</span></span>
<span id="annotated-cell-8-25"><a href="#annotated-cell-8-25" aria-hidden="true" tabindex="-1"></a>        FailureMessage <span class="op">=</span> <span class="va">$failureMessage</span></span>
<span id="annotated-cell-8-26"><a href="#annotated-cell-8-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-8-27"><a href="#annotated-cell-8-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="1" data-code-annotation="1">Pester Custom Assertion å°±æ˜¯ä¸€å€‹è‡ªå·±å¯«çš„ <a href="http://learn.microsoft.com/powershell/scripting/learn/ps101/09-functions#a-simple-function">PowerShell Simple Function</a>ï¼Œ<code>Verb-Noun</code> çš„å‘½åé¢¨æ ¼æ˜¯ <strong>Verb</strong> ç‚º <code>Should</code> ä¸å¯æ”¹å‹•ï¼Œ<strong>Noun</strong> <code>BeEqualWithPrecision</code> ç‚ºæˆ‘å€‘è‡ªå·±å®šç¾©çš„åç¨±ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="2,3,4,5" data-code-annotation="2">è¼¸å…¥å’Œè¼¸å‡ºçš„æ ¼å¼å€ç¬¦åˆ Pester çš„è¦ç¯„ï¼š<code>$ActualValue</code> æ˜¯å¯¦éš›å€¼ï¼Œ<code>$Negate</code> æ˜¯è¨­å®šæ˜¯å¦åè½‰å¸ƒæ—é‚è¼¯ï¼Œ<code>$Because</code> æ˜¯ Assertion å¤±æ•—æ™‚çš„è¨Šæ¯ï¼Œé€™ä¸‰å€‹è¼¸å…¥åƒæ•¸åç¨±ä¸€å®šè¦æ­£ç¢ºï¼›è€Œ<code>$ExpectValue</code> é æœŸå€¼å’Œè¨­å®šæµ®é»æ•¸å€¼ç²¾ç¢ºåº¦çš„ <code>$Precision</code> æ˜¯æˆ‘å€‘è‡ªå·±å®šç¾©çš„é¡å¤–è¼¸å…¥åƒæ•¸ï¼Œå¯æ–¼æ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼çš„ Assertion statements æ™‚å¤šæŒ‡å®šåœ¨ç¨‹å¼ç¢¼ä¸­ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="7" data-code-annotation="3">é€™å€‹ Custom Assertion çš„å¯¦ä½œæ˜¯é€éå°‡å…©å€‹æµ®é»æ•¸å€¼å››æ¨äº”å…¥åˆ°æŒ‡å®šç²¾ç¢ºåº¦å¾Œå†æ¯”è¼ƒæ˜¯å¦ç›¸ç­‰ï¼Œä»¥é”åˆ°æ¯”è¼ƒæµ®é»æ•¸å€¼çš„ç²¾ç¢ºåº¦æ¯”è¼ƒã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="8,9,10" data-code-annotation="4">å‡å¦‚æœ‰æŒ‡å®š <code>$Negate</code> åƒæ•¸ï¼Œå‰‡åè½‰åˆ¤æ–·çµæœçš„å¸ƒæ—å€¼ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="12,13,14,15,16,17,18,19,20,21" data-code-annotation="5">ç‚ºä¸åŒçš„ Assertion çµæœè¨­å®šä¸åŒçš„éŒ¯èª¤è¨Šæ¯ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="23,24,25,26" data-code-annotation="6">æœ€å¾Œå›å‚³ä¸€å€‹ <a href="http://learn.microsoft.com/powershell/scripting/learn/deep-dives/everything-about-pscustomobject">PSCustomObject</a> ç‰©ä»¶ï¼Œå…¶ä¸­åŒ…å«äº† Assertion çš„çµæœå¸ƒæ—å€¼(<code>Succeeded</code>)å’ŒéŒ¯èª¤è¨Šæ¯(<code>FailureMessage</code>)ã€‚</span>
</dd>
</dl>
<p>ç„¶å¾Œåœ¨æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼ä¸­å…ˆå‘¼å« <a href="https://pester.dev/docs/commands/Add-ShouldOperator"><code>Add-ShouldOperator</code></a>è¨»å†Š:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Demo1to1MappingTestModule/Production_test/ProductFeatures/MathFeatureModule/MathFeature.Tests.ps1</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="Demo1to1MappingTestModule/Production_test/ProductFeatures/MathFeatureModule/MathFeature.Tests.ps1"><pre class="sourceCode numberSource powershell ps1 number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb6-1"><a href=""></a>Add-ShouldOperator <span class="op">-</span>Name BeEqualWithPrecision <span class="op">-</span>Test <span class="pp">${</span><span class="va">Function:Should-BeEqualWithPrecision</span><span class="pp">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>å°±å¯ä»¥åœ¨æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç¨‹å¼ç¢¼æ™‚ä½¿ç”¨ <code>Should -BeEqualWithPrecision</code> é€™å€‹ Custom Assertion äº†ï¼š</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Demo1to1MappingTestModule/Production_test/ProductFeatures/MathFeatureModule/MathFeature.Tests.ps1</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="Demo1to1MappingTestModule/Production_test/ProductFeatures/MathFeatureModule/MathFeature.Tests.ps1"><pre class="sourceCode numberSource powershell ps1 number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb7-1"><a href=""></a><span class="va">$actual</span> <span class="op">|</span> Should <span class="op">-</span>BeEqualWithPrecision <span class="op">-</span>ExpectValue <span class="va">$expect</span> <span class="op">-</span>Precision <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="powershell-c-binary-cmdlet" class="title-slide slide level1 center">
<h1>PowerShell + C# binary cmdlet</h1>

</section>
<section id="powershell-c-binary-cmdlet-1" class="slide level2">
<h2>PowerShell + C# binary cmdlet</h2>
<ul>
<li>PowerShell v6+ &amp; Windows PowerShell 5.1+ éƒ½æ”¯æ´ä½¿ç”¨ C# ä¾†æ’°å¯« binary cmdlet ä¾†æ“´å…… PowerShell çš„åŠŸèƒ½ã€‚</li>
<li>é€é C# çš„å¼·å‹åˆ¥ã€é«˜æ•ˆèƒ½ã€å¤šåŸ·è¡Œç·’ç­‰ç‰¹æ€§ä¾†æ’°å¯« PowerShell çš„ binary cmdletï¼Œå¯ä»¥æé«˜ PowerShell scriptçš„åŸ·è¡Œæ•ˆèƒ½ã€‚</li>
<li>ä¸€äº› PowerShell åŸç”Ÿæ²’æœ‰æä¾›çš„åŠŸèƒ½å¯é€é C# ä¾†æ’°å¯« binary cmdlet ä¾†æ“´å…… PowerShell çš„ä½¿ç”¨ç¯„åœã€‚</li>
</ul>
<p>butâ€¦ C# binary cmdlet çš„æ¸¬è©¦æ¡ˆä¾‹æ’°å¯«ç›¸å°è¼ƒå›°é›£ğŸ˜µ</p>
</section>
<section id="powershell-c-binary-cmdlet-çš„ç°¡å–®ç¯„ä¾‹" class="slide level2 scrollable">
<h2>PowerShell C# binary cmdlet çš„ç°¡å–®ç¯„ä¾‹</h2>
<h3 id="demo-1"><strong><em>Demo</em></strong></h3>
<p><a href="http://github.com/windperson/BinaryPwshModuleDemo">ç¯„ä¾‹ç¨‹å¼ç¢¼ GitHub</a></p>
<ul>
<li>ä½¿ç”¨ <a href="http://www.nuget.org/packages/PowerShellStandard.Library/"><code>PowerShell.Standard.Library</code> Nuget å¥—ä»¶</a>çš„ binary cmdlet å¯åœ¨ Windows PowerShell v5.1+ &amp; PowerShell v7+ ç’°å¢ƒä¸­åŸ·è¡Œã€‚</li>
<li>ä½¿ç”¨ <a href="http://www.nuget.org/packages/System.Management.Automation/"><code>System.Management.Automation</code> Nuget å¥—ä»¶</a>çš„ binary cmdlet åƒ…èƒ½åœ¨ PowerShell Core/v7+ ç’°å¢ƒä¸­åŸ·è¡Œã€‚</li>
<li>ç¹¼æ‰¿ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.cmdlet"><code>Cmdlet</code></a> é¡åˆ¥ä¾†æ’°å¯« PowerShell Simple function çš„ binary cmdlet å¯¦ä½œã€‚</li>
<li>ç¹¼æ‰¿ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.pscmdlet"><code>PSCmdlet</code></a> é¡åˆ¥ä¾†æ’°å¯« <a href="http://learn.microsoft.com/powershell/module/microsoft.powershell.core/about/about_functions_advanced">PowerShell Advanced function</a> çš„ binary cmdlet å¯¦ä½œã€‚</li>
<li>ä½¿ç”¨ C# xUnitæ¸¬è©¦æ¡†æ¶ä¾†æ’°å¯«ç¹¼æ‰¿ <code>Cmdlet</code> çš„æ¸¬è©¦æ¡ˆä¾‹ã€‚</li>
</ul>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>ä½¿ç”¨ VSCode ä¾†è·‘åµéŒ¯ PowerShell binary cmdlet æ™‚ï¼Œæ³¨æ„ launch.json çš„ console éœ€è¨­å®šç‚º â€œ<strong>integratedTerminal</strong>â€ï¼Œå¦å‰‡ç„¡æ³•æ­£ç¢ºåœåœ¨ debug pointã€‚</p>
</div>
</div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.vscode/launch.json</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename=".vscode/launch.json" data-code-line-numbers="5,8,17,22,25,34"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb8-1"><a href=""></a><span class="fu">{</span></span>
<span id="cb8-2"><a href=""></a>     <span class="dt">"configurations"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb8-3"><a href=""></a>        <span class="fu">{</span></span>
<span id="cb8-4"><a href=""></a>            <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"NetStandard module Pwsh CLI"</span><span class="fu">,</span></span>
<span id="cb8-5"><a href=""></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"coreclr"</span><span class="fu">,</span></span>
<span id="cb8-6"><a href=""></a>            <span class="dt">"request"</span><span class="fu">:</span> <span class="st">"launch"</span><span class="fu">,</span></span>
<span id="cb8-7"><a href=""></a>            <span class="dt">"preLaunchTask"</span><span class="fu">:</span> <span class="st">"build netstandard module"</span><span class="fu">,</span></span>
<span id="cb8-8"><a href=""></a>            <span class="dt">"program"</span><span class="fu">:</span> <span class="st">"pwsh"</span><span class="fu">,</span></span>
<span id="cb8-9"><a href=""></a>            <span class="dt">"args"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb8-10"><a href=""></a>                <span class="st">"-NoExit"</span><span class="ot">,</span></span>
<span id="cb8-11"><a href=""></a>                <span class="st">"-NoProfile"</span><span class="ot">,</span></span>
<span id="cb8-12"><a href=""></a>                <span class="st">"-Command"</span><span class="ot">,</span></span>
<span id="cb8-13"><a href=""></a>                <span class="st">"Import-Module ${workspaceFolder}/src/PwshStandardModule/bin/Debug/netstandard2.0/PwshStandardModule.dll"</span></span>
<span id="cb8-14"><a href=""></a>            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb8-15"><a href=""></a>            <span class="dt">"cwd"</span><span class="fu">:</span> <span class="st">"${workspaceFolder}"</span><span class="fu">,</span></span>
<span id="cb8-16"><a href=""></a>            <span class="dt">"stopAtEntry"</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb8-17"><a href=""></a>            <span class="dt">"console"</span><span class="fu">:</span> <span class="st">"integratedTerminal"</span></span>
<span id="cb8-18"><a href=""></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb8-19"><a href=""></a>        <span class="fu">{</span></span>
<span id="cb8-20"><a href=""></a>            <span class="er">//</span> <span class="er">NOTE</span><span class="fu">:</span> <span class="er">this</span> <span class="er">task</span> <span class="er">is</span> <span class="er">Windows</span> <span class="er">only</span></span>
<span id="cb8-21"><a href=""></a>            <span class="st">"name"</span><span class="er">:</span> <span class="st">"NetStandard module Windows PowerShell CLI"</span><span class="fu">,</span></span>
<span id="cb8-22"><a href=""></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"clr"</span><span class="fu">,</span></span>
<span id="cb8-23"><a href=""></a>            <span class="dt">"request"</span><span class="fu">:</span> <span class="st">"launch"</span><span class="fu">,</span></span>
<span id="cb8-24"><a href=""></a>            <span class="dt">"preLaunchTask"</span><span class="fu">:</span> <span class="st">"build netstandard module"</span><span class="fu">,</span></span>
<span id="cb8-25"><a href=""></a>            <span class="dt">"program"</span><span class="fu">:</span> <span class="st">"powerShell"</span><span class="fu">,</span></span>
<span id="cb8-26"><a href=""></a>            <span class="dt">"args"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb8-27"><a href=""></a>                <span class="st">"-NoExit"</span><span class="ot">,</span></span>
<span id="cb8-28"><a href=""></a>                <span class="st">"-NoProfile"</span><span class="ot">,</span></span>
<span id="cb8-29"><a href=""></a>                <span class="st">"-Command"</span><span class="ot">,</span></span>
<span id="cb8-30"><a href=""></a>                <span class="st">"Import-Module ${workspaceFolder}/src/PwshStandardModule/bin/Debug/netstandard2.0/PwshStandardModule.dll"</span></span>
<span id="cb8-31"><a href=""></a>            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb8-32"><a href=""></a>            <span class="dt">"cwd"</span><span class="fu">:</span> <span class="st">"${workspaceFolder}"</span><span class="fu">,</span></span>
<span id="cb8-33"><a href=""></a>            <span class="dt">"stopAtEntry"</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb8-34"><a href=""></a>            <span class="dt">"console"</span><span class="fu">:</span> <span class="st">"integratedTerminal"</span></span>
<span id="cb8-35"><a href=""></a>        <span class="fu">}</span></span>
<span id="cb8-36"><a href=""></a>    <span class="ot">]</span></span>
<span id="cb8-37"><a href=""></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="powershell-c-binary-cmdlet-call-grpc-api" class="slide level2">
<h2><strong>(PowerShell + C# binary cmdlet)</strong> call gRPC API</h2>
<h3 id="demo-2"><strong><em>Demo</em></strong></h3>
<p><a href="http://github.com/windperson/MultiPlatformPwshCmdletDemo">ç¯„ä¾‹ç¨‹å¼ç¢¼ GitHub</a></p>
<ul>
<li>ä½¿ç”¨ <a href="https://devblogs.microsoft.com/dotnet/grpc-web-experiment/">gRPC-web</a> çš„ C# Client Nuget å¥—ä»¶ä»¥ä¾¿åœ¨ä¸æ”¯æ´ HTTP/2 çš„ Windows PowerShell ç’°å¢ƒä¸­å‘¼å« gRPC æœå‹™ã€‚
<ul>
<li>å¦‚ä½•ç‚º Windows PowerShell çš„ C# binary cmdlet æ’°å¯« Assembly Resolver ä»¥ä¾¿æˆåŠŸè¼‰å…¥ gRPC-Web client Libraryã€‚</li>
</ul></li>
<li>ç¹¼æ‰¿ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.pscmdlet"><code>PSCmdlet</code></a> é¡åˆ¥æ‰€æ’°å¯« <a href="http://learn.microsoft.com/powershell/module/microsoft.powershell.core/about/about_functions_advanced">PowerShell Advanced function</a> çš„ binary cmdlet å¦‚ä½•ä½¿ç”¨ xUnit æ¸¬è©¦æ¡†æ¶ä¾†æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ã€‚</li>
<li>ä½¿ç”¨æ··åˆ PowerShell .psd1 è¨­å®šæª” + C# binary cmdlet çš„æ–¹å¼ä¾†æ’°å¯«æ··åˆå‹ PowerShell Module å°ˆæ¡ˆã€‚
<ul>
<li>å¦‚ä½•æ–¼ Windows PowerShell v5.1 &amp; PowerShell v7+ è·‘åµéŒ¯ã€‚</li>
<li>å¦‚ä½•é‡å° PowerShell + C# ç¨‹å¼ç¢¼çš„å°ˆæ¡ˆæ’°å¯« PowerShell çš„ Pester æ¸¬è©¦æ¡ˆä¾‹ã€‚</li>
</ul></li>
</ul>
</section>
<section id="section" class="slide level2 smaller scrollable">
<h2></h2>
<p>gRPC-Web çš„ç›¸ä¾ Assembly dll ç‰ˆæœ¬æ¯”åŸæœ¬ Windows PowerShell v5.1 æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬æ–°ï¼Œéœ€è¦å¯«é¡å¤–çš„ Assembly Resolver ç¨‹å¼ç¢¼æ§åˆ¶ .NET Framework CLR è¼‰å…¥ dll æ©Ÿåˆ¶ã€‚</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Pwsh\GreeterCmdlet\WindowsPowerShellModuleInitializer.cs</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-12" data-filename="Pwsh\GreeterCmdlet\WindowsPowerShellModuleInitializer.cs"><pre class="sourceCode csharp cs code-annotation-code code-with-copy code-annotated"><code class="sourceCode cs"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">#if</span> NETSTANDARD2_0</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">;</span></span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Reflection</span><span class="op">;</span></span>
<span id="annotated-cell-12-4"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> GreeterCmdlet<span class="op">;</span></span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-12-7" class="code-annotation-target"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> WindowsPowerShellModuleInitializer <span class="op">:</span> IModuleAssemblyInitializer</span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">OnImport</span><span class="op">()</span></span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="annotated-cell-12-11"><a href="#annotated-cell-12-11" aria-hidden="true" tabindex="-1"></a>        AppDomain<span class="op">.</span><span class="fu">CurrentDomain</span><span class="op">.</span><span class="fu">AssemblyResolve</span> <span class="op">+=</span> DependencyResolution<span class="op">.</span><span class="fu">ResoleAssembly</span><span class="op">;</span></span>
<span id="annotated-cell-12-12"><a href="#annotated-cell-12-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-12-15" class="code-annotation-target"><a href="#annotated-cell-12-15" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> WindowsPowerShellModuleCleanup <span class="op">:</span> IModuleAssemblyCleanup</span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="annotated-cell-12-17"><a href="#annotated-cell-12-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">OnRemove</span><span class="op">(</span>PSModuleInfo psModuleInfo<span class="op">)</span></span>
<span id="annotated-cell-12-18"><a href="#annotated-cell-12-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="annotated-cell-12-19"><a href="#annotated-cell-12-19" aria-hidden="true" tabindex="-1"></a>        AppDomain<span class="op">.</span><span class="fu">CurrentDomain</span><span class="op">.</span><span class="fu">AssemblyResolve</span> <span class="op">-=</span> DependencyResolution<span class="op">.</span><span class="fu">ResoleAssembly</span><span class="op">;</span></span>
<span id="annotated-cell-12-20"><a href="#annotated-cell-12-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-12-21"><a href="#annotated-cell-12-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="annotated-cell-12-22"><a href="#annotated-cell-12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-23"><a href="#annotated-cell-12-23" aria-hidden="true" tabindex="-1"></a><span class="kw">internal</span> <span class="kw">static</span> <span class="kw">class</span> DependencyResolution</span>
<span id="annotated-cell-12-24"><a href="#annotated-cell-12-24" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="annotated-cell-12-25"><a href="#annotated-cell-12-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">readonly</span> <span class="dt">string</span> ModulePath <span class="op">=</span> </span>
<span id="annotated-cell-12-26"><a href="#annotated-cell-12-26" aria-hidden="true" tabindex="-1"></a>                                Path<span class="op">.</span><span class="fu">GetDirectoryName</span><span class="op">(</span>Assembly<span class="op">.</span><span class="fu">GetExecutingAssembly</span><span class="op">().</span><span class="fu">Location</span><span class="op">)!;</span></span>
<span id="annotated-cell-12-27"><a href="#annotated-cell-12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-28"><a href="#annotated-cell-12-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> Assembly <span class="fu">ResoleAssembly</span><span class="op">(</span><span class="dt">object</span><span class="op">?</span> sender<span class="op">,</span> ResolveEventArgs args<span class="op">)</span></span>
<span id="annotated-cell-12-29"><a href="#annotated-cell-12-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="annotated-cell-12-30"><a href="#annotated-cell-12-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> assemblyName <span class="op">=</span> <span class="kw">new</span> <span class="fu">AssemblyName</span><span class="op">(</span>args<span class="op">.</span><span class="fu">Name</span><span class="op">);</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-12-31" class="code-annotation-target"><a href="#annotated-cell-12-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>assemblyName<span class="op">.</span><span class="fu">Name</span> <span class="op">==</span> <span class="st">"System.Buffers"</span><span class="op">)</span></span>
<span id="annotated-cell-12-32"><a href="#annotated-cell-12-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="annotated-cell-12-33"><a href="#annotated-cell-12-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> Assembly<span class="op">.</span><span class="fu">LoadFrom</span><span class="op">(</span>Path<span class="op">.</span><span class="fu">Combine</span><span class="op">(</span>ModulePath<span class="op">,</span> <span class="st">"System.Buffers.dll"</span><span class="op">));</span></span>
<span id="annotated-cell-12-34"><a href="#annotated-cell-12-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="annotated-cell-12-35"><a href="#annotated-cell-12-35" aria-hidden="true" tabindex="-1"></a>        </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-12-36" class="code-annotation-target"><a href="#annotated-cell-12-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>assemblyName<span class="op">.</span><span class="fu">Name</span> <span class="op">==</span> <span class="st">"System.Runtime.CompilerServices.Unsafe"</span><span class="op">)</span></span>
<span id="annotated-cell-12-37"><a href="#annotated-cell-12-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="annotated-cell-12-38"><a href="#annotated-cell-12-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> Assembly<span class="op">.</span><span class="fu">LoadFrom</span><span class="op">(</span>Path<span class="op">.</span><span class="fu">Combine</span><span class="op">(</span>ModulePath<span class="op">,</span> <span class="st">"System.Runtime.CompilerServices.Unsafe.dll"</span><span class="op">));</span></span>
<span id="annotated-cell-12-39"><a href="#annotated-cell-12-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="annotated-cell-12-40"><a href="#annotated-cell-12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-41"><a href="#annotated-cell-12-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">null</span><span class="op">!;</span></span>
<span id="annotated-cell-12-42"><a href="#annotated-cell-12-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-12-43"><a href="#annotated-cell-12-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="annotated-cell-12-44"><a href="#annotated-cell-12-44" aria-hidden="true" tabindex="-1"></a><span class="kw">#endif</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="7,8,9,10,11,12,13" data-code-annotation="1">å¯¦ä½œ <code>IModuleAssemblyInitializer</code> ä»‹é¢è¨»å†Š Assembly Resolver äº‹ä»¶è™•ç†å‡½å¼ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="15,16,17,18,19,20,21" data-code-annotation="2">å¯¦ä½œ <code>IModuleAssemblyCleanup</code> ä»‹é¢ç§»é™¤ Assembly Resolver äº‹ä»¶è™•ç†å‡½å¼ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="31,32,33,34" data-code-annotation="3">é‡å° gRPC-Web client å¥—ä»¶ç›¸ä¾ <code>Systems.Buffers.dll</code> çš„ Assembly Resolver å¯¦ä½œï¼Œç›´æ¥è¼‰å…¥åŒç›®éŒ„ç”± MSBuild ä¸€èµ· copy éä¾†çš„ dll ç‰ˆæœ¬ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="36,37,38,39" data-code-annotation="4">é‡å° <code>Systems.Buffers</code> ç›¸ä¾ <code>System.Runtime.CompilerServices.Unsafe.dll</code> çš„ Assembly Resolver å¯¦ä½œï¼Œç›´æ¥è¼‰å…¥åŒç›®éŒ„ç”± MSBuild ä¸€èµ· copy éä¾†çš„ dll ç‰ˆæœ¬ã€‚</span>
</dd>
</dl>
</section>
<section id="section-1" class="slide level2 smaller scrollable">
<h2></h2>
<p>å°‡å¯¦éš›å‘¼å« gRPC æœå‹™çš„ C# ç¨‹å¼èˆ‡ Binary Cmdlet å°ˆæ¡ˆçš„åˆ†é–‹ä¸¦å®šç¾©ä»‹é¢ <code>IGreetingGrpcClient</code>ï¼Œä»¥ä¾¿æ–¼ç¨å¾Œæ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ã€‚</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Pwsh\GreeterCmdlet\CallGreetingClientLibCmdlet.cs</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="Pwsh\GreeterCmdlet\CallGreetingClientLibCmdlet.cs" data-code-line-numbers="10,32-40"><pre class="sourceCode numberSource csharp cs number-lines code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href=""></a><span class="op">[</span><span class="fu">Cmdlet</span><span class="op">(</span>VerbsCommunications<span class="op">.</span><span class="fu">Send</span><span class="op">,</span> <span class="st">"GreeterGrpcApi"</span><span class="op">)]</span></span>
<span id="cb9-2"><a href=""></a><span class="op">[</span><span class="fu">OutputType</span><span class="op">(</span><span class="kw">typeof</span><span class="op">(</span>GreetingResponse<span class="op">))]</span></span>
<span id="cb9-3"><a href=""></a><span class="kw">public</span> <span class="kw">class</span> CallGreetingClientLibCmdlet <span class="op">:</span> PSCmdlet</span>
<span id="cb9-4"><a href=""></a><span class="op">{</span></span>
<span id="cb9-5"><a href=""></a>    <span class="op">[</span><span class="fu">Parameter</span><span class="op">(</span>Mandatory <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> Position <span class="op">=</span> <span class="dv">0</span><span class="op">)]</span></span>
<span id="cb9-6"><a href=""></a>    <span class="kw">public</span> <span class="dt">string</span> Server <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dt">string</span><span class="op">.</span><span class="fu">Empty</span><span class="op">;</span></span>
<span id="cb9-7"><a href=""></a></span>
<span id="cb9-8"><a href=""></a>    <span class="op">[</span><span class="fu">Parameter</span><span class="op">(</span>Mandatory <span class="op">=</span> <span class="kw">true</span><span class="op">)]</span> <span class="kw">public</span> GreetingRequest Request <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">null</span><span class="op">!;</span></span>
<span id="cb9-9"><a href=""></a></span>
<span id="cb9-10"><a href=""></a>    <span class="op">[</span><span class="fu">Parameter</span><span class="op">(</span>Mandatory <span class="op">=</span> <span class="kw">false</span><span class="op">)]</span> <span class="kw">public</span> IGreetingGrpcClient ApiClient <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">GreetingClient</span><span class="op">();</span></span>
<span id="cb9-11"><a href=""></a></span>
<span id="cb9-12"><a href=""></a>    <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">BeginProcessing</span><span class="op">()</span></span>
<span id="cb9-13"><a href=""></a>    <span class="op">{</span></span>
<span id="cb9-14"><a href=""></a>        <span class="kw">if</span> <span class="op">(</span>ApiClient <span class="kw">is</span> GreetingClient greetingClient<span class="op">)</span></span>
<span id="cb9-15"><a href=""></a>        <span class="op">{</span></span>
<span id="cb9-16"><a href=""></a>            greetingClient<span class="op">.</span><span class="fu">ServerUrl</span> <span class="op">=</span> $<span class="st">"https://{Server}"</span><span class="op">;</span></span>
<span id="cb9-17"><a href=""></a>        <span class="op">}</span></span>
<span id="cb9-18"><a href=""></a>    <span class="op">}</span></span>
<span id="cb9-19"><a href=""></a></span>
<span id="cb9-20"><a href=""></a>    <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">ProcessRecord</span><span class="op">()</span></span>
<span id="cb9-21"><a href=""></a>    <span class="op">{</span></span>
<span id="cb9-22"><a href=""></a>        <span class="kw">try</span></span>
<span id="cb9-23"><a href=""></a>        <span class="op">{</span></span>
<span id="cb9-24"><a href=""></a>            <span class="dt">var</span> reply <span class="op">=</span> ApiClient<span class="op">.</span><span class="fu">GetGreeting</span><span class="op">(</span>Request<span class="op">);</span></span>
<span id="cb9-25"><a href=""></a>            <span class="fu">WriteObject</span><span class="op">(</span>reply<span class="op">);</span></span>
<span id="cb9-26"><a href=""></a>        <span class="op">}</span></span>
<span id="cb9-27"><a href=""></a>        <span class="kw">catch</span> <span class="op">(</span>Exception ex<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-28"><a href=""></a>            <span class="co">/* handle exception */</span></span>
<span id="cb9-29"><a href=""></a>        <span class="op">}</span></span>
<span id="cb9-30"><a href=""></a>    <span class="op">}</span></span>
<span id="cb9-31"><a href=""></a></span>
<span id="cb9-32"><a href=""></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb9-33"><a href=""></a>    <span class="co">/// This method is used for testing purposes only.</span></span>
<span id="cb9-34"><a href=""></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb9-35"><a href=""></a>    <span class="kw">internal</span> <span class="dt">void</span> <span class="fu">ProcessInternalForTest</span><span class="op">()</span></span>
<span id="cb9-36"><a href=""></a>    <span class="op">{</span></span>
<span id="cb9-37"><a href=""></a>        <span class="fu">BeginProcessing</span><span class="op">();</span></span>
<span id="cb9-38"><a href=""></a>        <span class="fu">ProcessRecord</span><span class="op">();</span></span>
<span id="cb9-39"><a href=""></a>        <span class="fu">EndProcessing</span><span class="op">();</span></span>
<span id="cb9-40"><a href=""></a>    <span class="op">}</span></span>
<span id="cb9-41"><a href=""></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>35~40è¡Œæ˜¯ç‚ºäº†è¦åœ¨æ¸¬è©¦ç¨‹å¼ç¢¼ä¸­æ¨¡æ“¬ PSCmdlet çš„ PowerShell runtime åŸ·è¡Œç’°å¢ƒï¼Œä»¥ä¾¿è®“æ¸¬è©¦ç¨‹å¼å‘¼å« PowerShell Cmdlet æä¾›çš„ <code>BeginProcessing()</code>, <code>ProcessRecord()</code>, <code>EndProcessing()</code> é€™ä¸‰å€‹ API å¯¦ä½œæ–¹æ³•ä¾åºåŸ·è¡Œçš„å…§è—å‡½å¼ï¼Œä¸¦åœ¨æ­¤å°ˆæ¡ˆçš„ .csproj è¨­å®šæª”ä¸­å®£å‘Š <code>&lt;InternalVisible&gt;...&lt;/InternalVisible&gt;</code>è®“ xUnit æ¸¬è©¦å°ˆæ¡ˆæœ‰æ¬Šé™å¯ä»¥åŸ·è¡Œæ­¤æ–¹æ³•ã€‚</p>
</div>
</div>
</div>
<p>å¯¦éš›å¯« xUnit test case æ™‚ï¼Œå¯ç”¨ <a href="https://www.nuget.org/packages/Moq"><code>Moq</code> nuget å¥—ä»¶</a>æä¾›çš„åŠŸèƒ½ç”¢ç”Ÿ <code>Mock&lt;IGreetingGrpcClient&gt;</code> ç‰©ä»¶ä¾†æ¨¡æ“¬å‘¼å« gRPC æœå‹™çš„è¡Œç‚ºã€‚</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tests\csharp\GreeterCmdletTests\CallGreetingClientLibCmdletTests.cs</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-14" data-filename="tests\csharp\GreeterCmdletTests\CallGreetingClientLibCmdletTests.cs"><pre class="sourceCode csharp cs code-annotation-code code-with-copy code-annotated"><code class="sourceCode cs"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>Fact<span class="op">]</span></span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">ProcessRecord_ShouldWriteObject_WhenApiClientReturnsResponse</span><span class="op">()</span></span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Arrange</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-14-5" class="code-annotation-target"><a href="#annotated-cell-14-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> mockApiClient <span class="op">=</span> <span class="kw">new</span> Mock<span class="op">&lt;</span>IGreetingGrpcClient<span class="op">&gt;();</span></span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> request <span class="op">=</span> <span class="kw">new</span> <span class="fu">GreetingRequest</span><span class="op">(</span><span class="st">"Test"</span><span class="op">);</span></span>
<span id="annotated-cell-14-7"><a href="#annotated-cell-14-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> response <span class="op">=</span> <span class="kw">new</span> <span class="fu">GreetingResponse</span><span class="op">(</span><span class="st">"Hello, Test!"</span><span class="op">);</span></span>
<span id="annotated-cell-14-8"><a href="#annotated-cell-14-8" aria-hidden="true" tabindex="-1"></a>    mockApiClient<span class="op">.</span><span class="fu">Setup</span><span class="op">(</span>client <span class="op">=&gt;</span> client<span class="op">.</span><span class="fu">GetGreeting</span><span class="op">(</span>request<span class="op">))</span></span>
<span id="annotated-cell-14-9"><a href="#annotated-cell-14-9" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">Returns</span><span class="op">(</span>response<span class="op">);</span></span>
<span id="annotated-cell-14-10"><a href="#annotated-cell-14-10" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="annotated-cell-14-11"><a href="#annotated-cell-14-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> cmdlet <span class="op">=</span> <span class="kw">new</span> CallGreetingClientLibCmdlet</span>
<span id="annotated-cell-14-12"><a href="#annotated-cell-14-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="annotated-cell-14-13"><a href="#annotated-cell-14-13" aria-hidden="true" tabindex="-1"></a>        Server <span class="op">=</span> <span class="st">"localhost"</span><span class="op">,</span></span>
<span id="annotated-cell-14-14"><a href="#annotated-cell-14-14" aria-hidden="true" tabindex="-1"></a>        Request <span class="op">=</span> request<span class="op">,</span></span>
<span id="annotated-cell-14-15"><a href="#annotated-cell-14-15" aria-hidden="true" tabindex="-1"></a>        ApiClient <span class="op">=</span> mockApiClient<span class="op">.</span><span class="fu">Object</span></span>
<span id="annotated-cell-14-16"><a href="#annotated-cell-14-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="annotated-cell-14-17"><a href="#annotated-cell-14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-18"><a href="#annotated-cell-14-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Act</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-14-19" class="code-annotation-target"><a href="#annotated-cell-14-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> pipelineEmulator <span class="op">=</span> <span class="kw">new</span> <span class="fu">CommandRuntimeEmulator</span><span class="op">();</span></span>
<span id="annotated-cell-14-20"><a href="#annotated-cell-14-20" aria-hidden="true" tabindex="-1"></a>    cmdlet<span class="op">.</span><span class="fu">CommandRuntime</span> <span class="op">=</span> pipelineEmulator<span class="op">;</span></span>
<span id="annotated-cell-14-21"><a href="#annotated-cell-14-21" aria-hidden="true" tabindex="-1"></a>    cmdlet<span class="op">.</span><span class="fu">ProcessInternalForTest</span><span class="op">();</span></span>
<span id="annotated-cell-14-22"><a href="#annotated-cell-14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-23"><a href="#annotated-cell-14-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Assert</span></span>
<span id="annotated-cell-14-24"><a href="#annotated-cell-14-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> results <span class="op">=</span> pipelineEmulator<span class="op">.</span><span class="fu">OutputObjects</span><span class="op">;</span></span>
<span id="annotated-cell-14-25"><a href="#annotated-cell-14-25" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">Single</span><span class="op">(</span>results<span class="op">);</span></span>
<span id="annotated-cell-14-26"><a href="#annotated-cell-14-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> actualResponse <span class="op">=</span> results<span class="op">.</span><span class="fu">First</span><span class="op">()</span> <span class="kw">as</span> GreetingResponse<span class="op">;</span></span>
<span id="annotated-cell-14-27"><a href="#annotated-cell-14-27" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">NotNull</span><span class="op">(</span>actualResponse<span class="op">);</span></span>
<span id="annotated-cell-14-28"><a href="#annotated-cell-14-28" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">Equal</span><span class="op">(</span>response<span class="op">.</span><span class="fu">Message</span><span class="op">,</span> actualResponse<span class="op">.</span><span class="fu">Message</span><span class="op">);</span></span>
<span id="annotated-cell-14-29"><a href="#annotated-cell-14-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="5,6,7,8,9" data-code-annotation="1">å»ºç«‹ <code>Mock&lt;IGreetingGrpcClient&gt;</code> ä¾†æ¨¡æ“¬å‘¼å« gRPC æœå‹™çš„è¡Œç‚ºï¼Œå°±ä¸éœ€åœ¨è·‘æ¸¬è©¦æ™‚ä½¿ç”¨å¯¦éš›çš„ gRPC Server æœå‹™ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="19,20,21" data-code-annotation="2">ä½¿ç”¨ <code>CommandRuntimeEmulator</code> é€™å€‹è‡ªè£½çš„å¯¦ä½œ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.icommandruntime"><code>ICommandRuntime</code> ä»‹é¢</a>é¡åˆ¥ä¾†æ¨¡æ“¬ Cmdlet çš„ PowerShell runtime å¯¦éš›åŸ·è¡Œç’°å¢ƒï¼Œä¸¦å‘¼å«é ç•™çš„ <code>ProcessInternalForTest()</code> æ–¹æ³•ä¾†ä¾åºåŸ·è¡Œæ­¤Cmdlet çš„ <code>BeginProcessing()</code>, <code>ProcessRecord()</code>, <code>EndProcessing()</code> é€™ä¸‰å€‹ API å¯¦ä½œã€‚</span>
</dd>
</dl>
</section></section>
<section>
<section id="asp.net-core-æ•´åˆ-powershell-hosting-environment" class="title-slide slide level1 center">
<h1>ASP.NET Core æ•´åˆ PowerShell Hosting Environment</h1>

</section>
<section id="asp.net-core-æ•´åˆ-powershell-hosting-environment-1" class="slide level2">
<h2>ASP.NET Core æ•´åˆ PowerShell Hosting Environment</h2>
<ul>
<li>ASP.NET Core v3.1+ çš„å°ˆæ¡ˆé€é <a href="http://www.nuget.org/packages/Microsoft.PowerShell.SDK"><code>Microsoft.PowerShell.SDK</code> nuget å¥—ä»¶</a>æ•´åˆ <a href="http://learn.microsoft.com/powershell/scripting/dev-cross-plat/choosing-the-right-nuget-package#microsoftpowershellsdk">PowerShell Hosting runtimeç’°å¢ƒ</a>ï¼Œä½¿ C# æ‡‰ç”¨ä»¥ <a href="https://learn.microsoft.com/powershell/scripting/developer/hosting/adding-and-invoking-commands">PowerShell C# API åŸ·è¡Œ PowerShell script æˆ– PowerShell Cmdlet æŒ‡ä»¤</a>ã€‚</li>
</ul>
</section>
<section id="asp.net-core-minimal-api-æ•´åˆåŸ·è¡Œ-powershell-script-ç¯„ä¾‹" class="slide level2">
<h2>ASP.NET Core Minimal API æ•´åˆåŸ·è¡Œ PowerShell Script ç¯„ä¾‹</h2>
<h3 id="demo-3"><strong><em>Demo</em></strong></h3>
<p><a href="http://github.com/windperson/MinimalApiCallPwshDemo">ç¯„ä¾‹ç¨‹å¼ç¢¼ GitHub</a></p>
<ul>
<li>æ­¤ç¯„ä¾‹ç¨‹å¼ç‚ºä¸€å€‹æª¢æŸ¥åŸ·è¡Œç’°å¢ƒä¸­å…©å€‹ç›®éŒ„æ˜¯å¦æœ‰åŒæ¨£æª”æ¡ˆçš„ Web APIï¼Œé€é PowerShell script ä¾†åŸ·è¡ŒçœŸæ­£æª”æ¡ˆæ¯”å°çš„å·¥ä½œã€‚</li>
<li>å¦‚ä½•åœ¨ .NET Core / .NET 5+ å°ˆæ¡ˆä½¿ç”¨ PowerShell Hosting Environment API æŒ‡æ´¾è¼¸å…¥åƒæ•¸çµ¦ PowerShell script åŸ·è¡Œï¼Œä¸¦å–å¾—åŸ·è¡Œçµæœã€‚</li>
<li><a href="https://xunit.net/">xUnit</a> æ¸¬è©¦å°ˆæ¡ˆ test method é–“æ¥åŸ·è¡Œç”¨ Pester æ’°å¯«çš„ PowerShell test case é©—è­‰ script è¡Œç‚ºã€‚</li>
</ul>
</section>
<section id="section-2" class="slide level2 smaller scrollable">
<h2></h2>
<p>æ­¤ PowerShell script åœ¨å…ˆå‰çš„ <a href="https://github.com/windperson/DemoPester/blob/main/Demo1to1MappingTestModule/Production/ProductFeatures/SysAdminUtil/DuplicateFilesFinder.psm1">Pester test case ç¯„ä¾‹å°ˆæ¡ˆä¸­æä¾›</a>ä¸¦ä¸”å·²æœ‰<a href="https://github.com/windperson/DemoPester/blob/main/Demo1to1MappingTestModule/Production_test/ProductFeatures/SysAdminUtil/DuplicateFilesFinder.Tests.ps1">é©—è­‰è¡Œç‚ºçš„æ¸¬è©¦æ¡ˆä¾‹</a>ã€‚</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./04_AspNetCore_Host/pics/cli_run_Duplicate_File_Finder.png" class="quarto-figure quarto-figure-center" style="height:100.0%"></p>
</figure>
</div>
<p>ä½¿ç”¨ PowerShell ä¾†æ’°å¯«å–å¾—æ‰€æœ‰æœ‰ç‰¹å®šå‰¯æª”åçš„æª”æ¡ˆé‚è¼¯ï¼Œæ¯”å–®ç´”ä½¿ç”¨ C# ç°¡å–®:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src\DemoWebApi\PwshScripts\DuplicateFilesFinder.psm1</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="src\DemoWebApi\PwshScripts\DuplicateFilesFinder.psm1" data-code-line-numbers="7"><pre class="sourceCode numberSource powershell ps1 number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb10-1"><a href=""></a><span class="kw">function</span> Get-Files <span class="op">{</span></span>
<span id="cb10-2"><a href=""></a>    <span class="op">[</span>SuppressMessage<span class="op">(</span><span class="st">'PSUseSingularNouns'</span><span class="op">,</span> <span class="st">''</span><span class="op">)]</span></span>
<span id="cb10-3"><a href=""></a>    <span class="kw">param</span> <span class="op">(</span></span>
<span id="cb10-4"><a href=""></a>        <span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="va">$Path</span><span class="op">,</span></span>
<span id="cb10-5"><a href=""></a>        <span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="va">$Extension</span></span>
<span id="cb10-6"><a href=""></a>    <span class="op">)</span></span>
<span id="cb10-7"><a href=""></a>    <span class="cf">return</span> <span class="fu">Get-ChildItem</span> <span class="op">-</span>Path <span class="va">$Path</span> <span class="op">-</span>Recurse <span class="op">-</span>File <span class="op">-</span>Filter <span class="st">"*.</span><span class="va">$Extension</span><span class="st">"</span></span>
<span id="cb10-8"><a href=""></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ä¹Ÿå¯ç”¨PowerShell çš„ <a href="http://learn.microsoft.com/powershell/module/microsoft.powershell.utility/get-filehash"><code>Get-FileHash</code> Cmdlet</a> å–å¾—æª”æ¡ˆçš„ Hash å€¼ä¾†å¿«é€Ÿåˆ¤æ–·æª”æ¡ˆå…§å®¹æ˜¯å¦ç›¸åŒ:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src\DemoWebApi\PwshScripts\DuplicateFilesFinder.psm1</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="src\DemoWebApi\PwshScripts\DuplicateFilesFinder.psm1" data-code-line-numbers="8"><pre class="sourceCode numberSource powershell ps1 number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb11-1"><a href=""></a><span class="kw">function</span> Get-FileContentHash <span class="op">{</span></span>
<span id="cb11-2"><a href=""></a>    <span class="op">[</span>SuppressMessage<span class="op">(</span><span class="st">'PSAvoidUsingBrokenHashAlgorithms'</span><span class="op">,</span> <span class="st">''</span><span class="op">,</span> </span>
<span id="cb11-3"><a href=""></a>        Justification <span class="op">=</span> <span class="st">'MD5 is just used for file hash comparison'</span><span class="op">)]</span></span>
<span id="cb11-4"><a href=""></a>    <span class="kw">param</span> <span class="op">(</span></span>
<span id="cb11-5"><a href=""></a>        <span class="op">[</span>Parameter<span class="op">(</span>Mandatory <span class="op">=</span> <span class="va">$true</span><span class="op">)]</span></span>
<span id="cb11-6"><a href=""></a>        <span class="op">[</span>System<span class="op">.</span><span class="fu">IO</span><span class="op">.</span><span class="fu">FileInfo</span><span class="op">]</span><span class="va">$FilePath</span></span>
<span id="cb11-7"><a href=""></a>    <span class="op">)</span></span>
<span id="cb11-8"><a href=""></a>    <span class="cf">return</span> Get-FileHash <span class="op">-</span>Algorithm MD5 <span class="op">-</span>Path <span class="va">$FilePath</span> <span class="co"># -SilentlyContinue</span></span>
<span id="cb11-9"><a href=""></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-3" class="slide level2 smaller scrollable">
<h2></h2>
<p>åœ¨ ASP.NET Core Minimal API ä¸­ä½¿ç”¨ PowerShell Hosting Environment ä¾†åŸ·è¡Œ PowerShell script/æŒ‡ä»¤ï¼Œéœ€è¦å…ˆå»ºç«‹ç›¸é—œçš„ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell">PowerShell</a>, <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.runspaces.runspace">Runspace</a> ç­‰ API ç‰©ä»¶ï¼Œä»¥åŠä½¿ç”¨ <code>.AddScript()</code>/<code>.AddCommand()</code>/<code>.AddParameter()</code> ç­‰ chainable fluent API çš„æ–¹å¼ä¾†è¨­å®š PowerShell script çš„åŸ·è¡Œç’°å¢ƒ:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src\DemoWebApi\Services\DuplicateFileFinderInvokeService.cs</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-17" data-filename="src\DemoWebApi\Services\DuplicateFileFinderInvokeService.cs"><pre class="sourceCode csharp cs code-annotation-code code-with-copy code-annotated"><code class="sourceCode cs"><span id="annotated-cell-17-1"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">DuplicateFileFinderInvokeService</span><span class="op">(</span>ILogger<span class="op">&lt;</span>DuplicateFileFinderInvokeService<span class="op">&gt;</span> logger<span class="op">)</span></span>
<span id="annotated-cell-17-2"><a href="#annotated-cell-17-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-17-3" class="code-annotation-target"><a href="#annotated-cell-17-3" aria-hidden="true" tabindex="-1"></a>    _runspacePool <span class="op">=</span> RunspaceFactory<span class="op">.</span><span class="fu">CreateRunspacePool</span><span class="op">();</span></span>
<span id="annotated-cell-17-4"><a href="#annotated-cell-17-4" aria-hidden="true" tabindex="-1"></a>    _runspacePool<span class="op">.</span><span class="fu">Open</span><span class="op">();</span></span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5" aria-hidden="true" tabindex="-1"></a>    _logger <span class="op">=</span> logger<span class="op">;</span></span>
<span id="annotated-cell-17-6"><a href="#annotated-cell-17-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-17-8"><a href="#annotated-cell-17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>IList<span class="op">&lt;</span>DuplicateFileResult<span class="op">&gt;&gt;</span> <span class="fu">RunScriptAsync</span><span class="op">(</span>ApiInputDto funcInput<span class="op">,</span></span>
<span id="annotated-cell-17-9"><a href="#annotated-cell-17-9" aria-hidden="true" tabindex="-1"></a>    CancellationToken cancellationToken<span class="op">)</span></span>
<span id="annotated-cell-17-10"><a href="#annotated-cell-17-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="annotated-cell-17-11"><a href="#annotated-cell-17-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">var</span> ps <span class="op">=</span> PowerShell<span class="op">.</span><span class="fu">Create</span><span class="op">();</span></span>
<span id="annotated-cell-17-12"><a href="#annotated-cell-17-12" aria-hidden="true" tabindex="-1"></a>    ps<span class="op">.</span><span class="fu">RunspacePool</span> <span class="op">=</span> _runspacePool<span class="op">;</span></span>
<span id="annotated-cell-17-13"><a href="#annotated-cell-17-13" aria-hidden="true" tabindex="-1"></a>    cancellationToken<span class="op">.</span><span class="fu">Register</span><span class="op">(()</span> <span class="op">=&gt;</span></span>
<span id="annotated-cell-17-14"><a href="#annotated-cell-17-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-17-15" class="code-annotation-target"><a href="#annotated-cell-17-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>ps<span class="op">.</span><span class="fu">InvocationStateInfo</span><span class="op">.</span><span class="fu">State</span> <span class="op">==</span> PSInvocationState<span class="op">.</span><span class="fu">Running</span><span class="op">)</span></span>
<span id="annotated-cell-17-16"><a href="#annotated-cell-17-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="annotated-cell-17-17"><a href="#annotated-cell-17-17" aria-hidden="true" tabindex="-1"></a>            ps<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="annotated-cell-17-18"><a href="#annotated-cell-17-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="annotated-cell-17-19"><a href="#annotated-cell-17-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="annotated-cell-17-20"><a href="#annotated-cell-17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-17-21"><a href="#annotated-cell-17-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* ... */</span></span>
<span id="annotated-cell-17-22"><a href="#annotated-cell-17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-17-23"><a href="#annotated-cell-17-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">try</span></span>
<span id="annotated-cell-17-24"><a href="#annotated-cell-17-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-17-25" class="code-annotation-target"><a href="#annotated-cell-17-25" aria-hidden="true" tabindex="-1"></a>        ps<span class="op">.</span><span class="fu">AddScript</span><span class="op">(</span><span class="st">"Import-Module ./PwshScripts/DuplicateFilesFinder.psm1 -Verbose"</span><span class="op">)</span></span>
<span id="annotated-cell-17-26"><a href="#annotated-cell-17-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">AddStatement</span><span class="op">();</span></span>
<span id="annotated-cell-17-27"><a href="#annotated-cell-17-27" aria-hidden="true" tabindex="-1"></a>        ps<span class="op">.</span><span class="fu">AddCommand</span><span class="op">(</span><span class="st">"Get-DuplicateFile"</span><span class="op">)</span></span>
<span id="annotated-cell-17-28"><a href="#annotated-cell-17-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">AddParameter</span><span class="op">(</span><span class="st">"SourcePath"</span><span class="op">,</span> funcInput<span class="op">.</span><span class="fu">SourceFolder</span><span class="op">)</span></span>
<span id="annotated-cell-17-29"><a href="#annotated-cell-17-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">AddParameter</span><span class="op">(</span><span class="st">"ComparePath"</span><span class="op">,</span> funcInput<span class="op">.</span><span class="fu">CompareFolder</span><span class="op">);</span></span>
<span id="annotated-cell-17-30"><a href="#annotated-cell-17-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(!</span><span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrEmpty</span><span class="op">(</span>funcInput<span class="op">.</span><span class="fu">CompareType</span><span class="op">))</span></span>
<span id="annotated-cell-17-31"><a href="#annotated-cell-17-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="annotated-cell-17-32"><a href="#annotated-cell-17-32" aria-hidden="true" tabindex="-1"></a>            ps<span class="op">.</span><span class="fu">AddParameter</span><span class="op">(</span><span class="st">"CompareType"</span><span class="op">,</span> funcInput<span class="op">.</span><span class="fu">CompareType</span><span class="op">);</span></span>
<span id="annotated-cell-17-33"><a href="#annotated-cell-17-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="annotated-cell-17-34"><a href="#annotated-cell-17-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* run above arranged commands via ps.Invoke(...) or ps.InvokeAsync(...) */</span></span>
<span id="annotated-cell-17-35"><a href="#annotated-cell-17-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-17-36"><a href="#annotated-cell-17-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">catch</span> <span class="op">(</span>Exception ex<span class="op">)</span></span>
<span id="annotated-cell-17-37"><a href="#annotated-cell-17-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="annotated-cell-17-38"><a href="#annotated-cell-17-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// handle exception</span></span>
<span id="annotated-cell-17-39"><a href="#annotated-cell-17-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-17-40"><a href="#annotated-cell-17-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="3,4" data-code-annotation="1">ä½¿ç”¨ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.runspaces.runspacepool"><code>RunspacePool</code></a> ä¾†ç®¡ç† <a href="http://learn.microsoft.com/powershell/scripting/developer/hosting/creating-runspaces">PowerShell çš„ Runspace åŸ·è¡Œç’°å¢ƒ</a>ï¼Œè¨˜å¾—è¦å‘¼å« <a href="https://learn.microsoft.com/en-us/dotnet/api/system.management.automation.runspaces.runspace.open?view=powershellsdk-7.4.0"><code>.Open()</code></a> å¾Œæ‰èƒ½å¾ŒçºŒåœ¨ PowerShell ç‰©ä»¶ä¸ŠåŸ·è¡Œ <a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell.invoke"><code>.Invoke()</code></a>/<a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell.invokeasync"><code>.InvokeAsync()</code></a> å¯¦éš›è·‘ PowerShell ç¨‹å¼ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="15,16,17,18" data-code-annotation="2">è¨­å®šç•¶ CancellationToken è§¸ç™¼æ™‚ï¼Œåœæ­¢ç›®å‰ PowerShell runtime çš„åŸ·è¡Œã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="25,26,27,28,29,30,31,32,33" data-code-annotation="3"><a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell.addscript"><code>.AddScript()</code></a> ç”¨ä¾†è¼‰å…¥ PowerShell script æª”æ¡ˆï¼Œ<a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell.addstatement"><code>.AddStatement()</code></a>åŒç­‰æ–¼ PowerShell script æª”æ¡ˆè£¡æ›è¡Œï¼Œ<a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell.addcommand"><code>.AddCommand()</code></a> è¡¨ç¤ºåŸ·è¡Œ PowerShell function/Cmdletï¼Œ<a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell.addcommand"><code>.AddParameter()</code></a>/<a href="http://learn.microsoft.com/dotnet/api/system.management.automation.powershell.addparameters"><code>.AddParameters()</code></a> ç”¨ä¾†è¨­å®šå‰é¢é è¨ˆè¦åŸ·è¡Œçš„ PowerShell function/Cmdlet çš„è¼¸å…¥åƒæ•¸å€¼ã€‚</span>
</dd>
</dl>
</section>
<section id="section-4" class="slide level2 smaller scrollable">
<h2></h2>
<p>åŸæœ¬åœ¨ PowrShell script è£¡ç”¨çš„æ˜¯ <a href="http://learn.microsoft.com/powershell/module/microsoft.powershell.core/about/about_classes">PowerShell å®šç¾©è‡ªè¨‚ Class é¡åˆ¥</a>ï¼Œå› æ­¤åœ¨åŸ·è¡Œå®Œç•¢å›å‚³çš„çµæœå€¼ç‰©ä»¶ç›´æ¥ä½¿ç”¨ <a href="https://learn.microsoft.com/dotnet/csharp/advanced-topics/interop/using-type-dynamic"><strong><code>dynamic</code></strong> keyword</a> å¯«æ³•ç°¡åŒ–å–å¾— FilePath1 &amp; FilePath2 å±¬æ€§å€¼ç¨‹å¼ç¢¼ã€‚</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src\DemoWebApi\Services\DuplicateFileFinderInvokeService.cs</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-18" data-filename="src\DemoWebApi\Services\DuplicateFileFinderInvokeService.cs"><pre class="sourceCode csharp cs code-annotation-code code-with-copy code-annotated"><code class="sourceCode cs"><span id="annotated-cell-18-1"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> result <span class="op">=</span></span>
<span id="annotated-cell-18-2"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a>    ps<span class="op">.</span><span class="fu">Invoke</span><span class="op">(</span>input<span class="op">:</span> <span class="kw">null</span><span class="op">,</span> settings<span class="op">:</span> psInvocationSettings<span class="op">)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-18-3" class="code-annotation-target"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">FirstOrDefault</span><span class="op">()?.</span><span class="fu">BaseObject</span> <span class="kw">as</span> <span class="dt">object</span><span class="op">[];</span></span>
<span id="annotated-cell-18-4"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-18-5"><a href="#annotated-cell-18-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> duplicateFileResults <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>DuplicateFileResult<span class="op">&gt;(</span>result<span class="op">.</span><span class="fu">Length</span><span class="op">);</span></span>
<span id="annotated-cell-18-6"><a href="#annotated-cell-18-6" aria-hidden="true" tabindex="-1"></a><span class="co">// use dynamic to make simpler coding style to avoid reflection</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-18-7" class="code-annotation-target"><a href="#annotated-cell-18-7" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span>dynamic duplicateFileInfo <span class="kw">in</span> result<span class="op">)</span></span>
<span id="annotated-cell-18-8"><a href="#annotated-cell-18-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="annotated-cell-18-9"><a href="#annotated-cell-18-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> duplicateFileResult <span class="op">=</span> <span class="kw">new</span> DuplicateFileResult</span>
<span id="annotated-cell-18-10"><a href="#annotated-cell-18-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-18-11" class="code-annotation-target"><a href="#annotated-cell-18-11" aria-hidden="true" tabindex="-1"></a>        SourceFilePath <span class="op">=</span> duplicateFileInfo<span class="op">.</span><span class="fu">FilePath1</span><span class="op">.</span><span class="fu">ToString</span><span class="op">(),</span></span>
<span id="annotated-cell-18-12"><a href="#annotated-cell-18-12" aria-hidden="true" tabindex="-1"></a>        CompareFilePath <span class="op">=</span> duplicateFileInfo<span class="op">.</span><span class="fu">FilePath2</span><span class="op">.</span><span class="fu">ToString</span><span class="op">()</span></span>
<span id="annotated-cell-18-13"><a href="#annotated-cell-18-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="annotated-cell-18-14"><a href="#annotated-cell-18-14" aria-hidden="true" tabindex="-1"></a>    duplicateFileResults<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>duplicateFileResult<span class="op">);</span></span>
<span id="annotated-cell-18-15"><a href="#annotated-cell-18-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="annotated-cell-18-16"><a href="#annotated-cell-18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-18-17"><a href="#annotated-cell-18-17" aria-hidden="true" tabindex="-1"></a><span class="kw">return</span> duplicateFileResults<span class="op">;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="3" data-code-annotation="1">ç”±æ–¼åŸæœ¬ PowerShell script function çš„å›å‚³å€¼æ˜¯å–®å€‹ç‰©ä»¶é™£åˆ—ï¼Œæ‰€ä»¥å–å¾—å›å‚³å€¼é †ä¾¿å…ˆè½‰å‹æˆ <code>object[]</code> é™£åˆ—ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="7" data-code-annotation="2">ä½¿ç”¨ <code>dynamic</code> é—œéµå­—ä¾†ç°¡åŒ–åŸæœ¬ PowerShell ç¨‹å¼ç¢¼ä¸­å®šç¾©çš„è‡ªè¨‚ class å‹åˆ¥ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="11,12" data-code-annotation="3">å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç‰©ä»¶çš„å±¬æ€§å€¼ï¼ˆC#ç·¨è­¯å™¨ä¸æª¢æŸ¥ï¼Œå¦‚æœå¯«éŒ¯å°±æœƒæœ‰ runtime exceptionï¼‰ã€‚</span>
</dd>
</dl>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./04_AspNetCore_Host/pics/pwsh_defined_class_return_object.png" class="quarto-figure quarto-figure-center" style="height:100.0%"></p>
</figure>
</div>
</section>
<section id="åŸ·è¡Œ-pester-æ¸¬è©¦çš„-xunit-ç¨‹å¼ç¢¼" class="slide level2 smaller scrollable">
<h2>åŸ·è¡Œ Pester æ¸¬è©¦çš„ xUnit ç¨‹å¼ç¢¼</h2>
<p>åœ¨ xUnit Test method ä¸­å‘¼å« PowerShell runtime åŸ·è¡Œ Pester æ¸¬è©¦æ¡ˆä¾‹ï¼Œä½¿ç”¨ Pester æ¡†æ¶æä¾›çš„ <a href="https://pester.dev/docs/commands/Invoke-Pester#-passthru"><code>Invoke-Pester</code> Cmdlet çš„ <strong><code>-PassThru</code></strong> å‘½ä»¤åˆ—åƒæ•¸</a>ï¼Œå¯ä½¿ Pester å°‡åŸ·è¡Œæ¸¬è©¦çµæœå‚³å‡ºï¼Œå†æ–¼ C# ä¸­é©—è­‰æ¸¬è©¦çµæœæ˜¯å¦ç¬¦åˆé æœŸ:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tests\DemoWebApi.Tests\PwshModuleTest.cs</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-19" data-filename="tests\DemoWebApi.Tests\PwshModuleTest.cs"><pre class="sourceCode csharp cs code-annotation-code code-with-copy code-annotated"><code class="sourceCode cs"><span id="annotated-cell-19-1"><a href="#annotated-cell-19-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>Fact<span class="op">]</span></span>
<span id="annotated-cell-19-2"><a href="#annotated-cell-19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">TestDuplicateFileFinderPwshFunction</span><span class="op">()</span></span>
<span id="annotated-cell-19-3"><a href="#annotated-cell-19-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="annotated-cell-19-4"><a href="#annotated-cell-19-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Arrange</span></span>
<span id="annotated-cell-19-5"><a href="#annotated-cell-19-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">var</span> runspace <span class="op">=</span> RunspaceFactory<span class="op">.</span><span class="fu">CreateRunspace</span><span class="op">();</span></span>
<span id="annotated-cell-19-6"><a href="#annotated-cell-19-6" aria-hidden="true" tabindex="-1"></a>    runspace<span class="op">.</span><span class="fu">Open</span><span class="op">();</span></span>
<span id="annotated-cell-19-7"><a href="#annotated-cell-19-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">var</span> ps <span class="op">=</span> PowerShell<span class="op">.</span><span class="fu">Create</span><span class="op">(</span>runspace<span class="op">);</span></span>
<span id="annotated-cell-19-8"><a href="#annotated-cell-19-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> psInvocationSettings <span class="op">=</span> <span class="kw">new</span> PSInvocationSettings</span>
<span id="annotated-cell-19-9"><a href="#annotated-cell-19-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="annotated-cell-19-10"><a href="#annotated-cell-19-10" aria-hidden="true" tabindex="-1"></a>        AddToHistory <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="annotated-cell-19-11"><a href="#annotated-cell-19-11" aria-hidden="true" tabindex="-1"></a>        ErrorActionPreference <span class="op">=</span> ActionPreference<span class="op">.</span><span class="fu">Stop</span><span class="op">,</span></span>
<span id="annotated-cell-19-12"><a href="#annotated-cell-19-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="annotated-cell-19-13"><a href="#annotated-cell-19-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">#region TestScript</span></span>
<span id="annotated-cell-19-14"><a href="#annotated-cell-19-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">string</span> testScript <span class="op">=</span> </span>
<span id="annotated-cell-19-15"><a href="#annotated-cell-19-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-19-16" class="code-annotation-target"><a href="#annotated-cell-19-16" aria-hidden="true" tabindex="-1"></a>    $tempModulePath <span class="op">=</span> $env<span class="op">:</span>TEMP <span class="op">+</span> <span class="st">"\PwshModule$((Get-Date).Ticks)"</span></span>
<span id="annotated-cell-19-17"><a href="#annotated-cell-19-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">(-</span><span class="fu">not</span> <span class="op">(</span>Test<span class="op">-</span>Path $tempModulePath<span class="op">))</span> <span class="op">{</span></span>
<span id="annotated-cell-19-18"><a href="#annotated-cell-19-18" aria-hidden="true" tabindex="-1"></a>        New<span class="op">-</span>Item <span class="op">-</span>Path $tempModulePath <span class="op">-</span>ItemType Directory <span class="op">-</span>ErrorAction Stop <span class="op">|</span> Out<span class="op">-</span>Null</span>
<span id="annotated-cell-19-19"><a href="#annotated-cell-19-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="annotated-cell-19-20"><a href="#annotated-cell-19-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> <span class="op">{</span></span>
<span id="annotated-cell-19-21"><a href="#annotated-cell-19-21" aria-hidden="true" tabindex="-1"></a>        Remove<span class="op">-</span>Item <span class="op">-</span>Path $tempModulePath <span class="op">-</span>Recurse <span class="op">-</span>Force <span class="op">-</span>ErrorAction Stop <span class="op">|</span> Out<span class="op">-</span>Null</span>
<span id="annotated-cell-19-22"><a href="#annotated-cell-19-22" aria-hidden="true" tabindex="-1"></a>        New<span class="op">-</span>Item <span class="op">-</span>Path $tempModulePath <span class="op">-</span>ItemType Directory <span class="op">-</span>ErrorAction Stop <span class="op">|</span> Out<span class="op">-</span>Null</span>
<span id="annotated-cell-19-23"><a href="#annotated-cell-19-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-19-24" class="code-annotation-target"><a href="#annotated-cell-19-24" aria-hidden="true" tabindex="-1"></a>    Save<span class="op">-</span>Module <span class="op">-</span>Name Pester <span class="op">-</span>Path $tempModulePath <span class="op">-</span>ErrorAction Stop</span>
<span id="annotated-cell-19-25"><a href="#annotated-cell-19-25" aria-hidden="true" tabindex="-1"></a>    Import<span class="op">-</span>Module $tempModulePath\Pester <span class="op">-</span>Force <span class="op">-</span>ErrorAction Stop</span>
<span id="annotated-cell-19-26"><a href="#annotated-cell-19-26" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-19-27" class="code-annotation-target"><a href="#annotated-cell-19-27" aria-hidden="true" tabindex="-1"></a>    $currentDir <span class="op">=</span> <span class="op">[</span>System<span class="op">.</span><span class="fu">IO</span><span class="op">.</span><span class="fu">Directory</span><span class="op">]::</span><span class="fu">GetCurrentDirectory</span><span class="op">()</span></span>
<span id="annotated-cell-19-28"><a href="#annotated-cell-19-28" aria-hidden="true" tabindex="-1"></a>    $TestScriptPath <span class="op">=</span> <span class="st">"$currentDir\..\..\..\PwshScripts\DuplicateFilesFinder.Tests.ps1"</span></span>
<span id="annotated-cell-19-29"><a href="#annotated-cell-19-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">(-</span><span class="fu">not</span> <span class="op">(</span>Test<span class="op">-</span>Path $TestScriptPath<span class="op">))</span> <span class="op">{</span></span>
<span id="annotated-cell-19-30"><a href="#annotated-cell-19-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">throw</span> <span class="st">"Test script not found at $TestScriptPath"</span></span>
<span id="annotated-cell-19-31"><a href="#annotated-cell-19-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-19-32" class="code-annotation-target"><a href="#annotated-cell-19-32" aria-hidden="true" tabindex="-1"></a>    $result <span class="op">=</span> Invoke<span class="op">-</span>Pester <span class="op">-</span>Path $TestScriptPath <span class="op">-</span>PassThru</span>
<span id="annotated-cell-19-33"><a href="#annotated-cell-19-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> $result</span>
<span id="annotated-cell-19-34"><a href="#annotated-cell-19-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">""";</span></span>
<span id="annotated-cell-19-35"><a href="#annotated-cell-19-35" aria-hidden="true" tabindex="-1"></a>    <span class="dv">#endregion</span></span>
<span id="annotated-cell-19-36"><a href="#annotated-cell-19-36" aria-hidden="true" tabindex="-1"></a>    ps<span class="op">.</span><span class="fu">AddScript</span><span class="op">(</span>testScript<span class="op">);</span></span>
<span id="annotated-cell-19-37"><a href="#annotated-cell-19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-19-38"><a href="#annotated-cell-19-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Act</span></span>
<span id="annotated-cell-19-39"><a href="#annotated-cell-19-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> psResult <span class="op">=</span> ps<span class="op">.</span><span class="fu">Invoke</span><span class="op">(</span>input<span class="op">:</span> <span class="kw">null</span><span class="op">,</span> settings<span class="op">:</span> psInvocationSettings<span class="op">).</span><span class="fu">FirstOrDefault</span><span class="op">();</span></span>
<span id="annotated-cell-19-40"><a href="#annotated-cell-19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-19-41"><a href="#annotated-cell-19-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Assert</span></span>
<span id="annotated-cell-19-42"><a href="#annotated-cell-19-42" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">NotNull</span><span class="op">(</span>psResult<span class="op">);</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="5" onclick="event.preventDefault();" href="">5</a><span id="annotated-cell-19-43" class="code-annotation-target"><a href="#annotated-cell-19-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> testResult <span class="op">=</span> psResult<span class="op">.</span><span class="fu">Properties</span><span class="op">[</span><span class="st">"Result"</span><span class="op">].</span><span class="fu">Value</span> <span class="kw">as</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="annotated-cell-19-44"><a href="#annotated-cell-19-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> totalCount <span class="op">=</span> psResult<span class="op">.</span><span class="fu">Properties</span><span class="op">[</span><span class="st">"TotalCount"</span><span class="op">].</span><span class="fu">Value</span> <span class="kw">as</span> <span class="dt">int</span><span class="op">?;</span></span>
<span id="annotated-cell-19-45"><a href="#annotated-cell-19-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> passedCount <span class="op">=</span> psResult<span class="op">.</span><span class="fu">Properties</span><span class="op">[</span><span class="st">"PassedCount"</span><span class="op">].</span><span class="fu">Value</span> <span class="kw">as</span> <span class="dt">int</span><span class="op">?;</span></span>
<span id="annotated-cell-19-46"><a href="#annotated-cell-19-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> failedCount <span class="op">=</span> psResult<span class="op">.</span><span class="fu">Properties</span><span class="op">[</span><span class="st">"FailedCount"</span><span class="op">].</span><span class="fu">Value</span> <span class="kw">as</span> <span class="dt">int</span><span class="op">?;</span></span>
<span id="annotated-cell-19-47"><a href="#annotated-cell-19-47" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">NotNull</span><span class="op">(</span>testResult<span class="op">);</span></span>
<span id="annotated-cell-19-48"><a href="#annotated-cell-19-48" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">NotNull</span><span class="op">(</span>totalCount<span class="op">);</span></span>
<span id="annotated-cell-19-49"><a href="#annotated-cell-19-49" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">NotNull</span><span class="op">(</span>passedCount<span class="op">);</span></span>
<span id="annotated-cell-19-50"><a href="#annotated-cell-19-50" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">NotNull</span><span class="op">(</span>failedCount<span class="op">);</span></span>
<span id="annotated-cell-19-51"><a href="#annotated-cell-19-51" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">Equal</span><span class="op">(</span><span class="st">"Passed"</span><span class="op">,</span> testResult<span class="op">);</span></span>
<span id="annotated-cell-19-52"><a href="#annotated-cell-19-52" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">True</span><span class="op">(</span>passedCount <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="annotated-cell-19-53"><a href="#annotated-cell-19-53" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">Equal</span><span class="op">(</span>totalCount<span class="op">,</span> passedCount<span class="op">);</span></span>
<span id="annotated-cell-19-54"><a href="#annotated-cell-19-54" aria-hidden="true" tabindex="-1"></a>    Assert<span class="op">.</span><span class="fu">Equal</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> failedCount<span class="op">);</span></span>
<span id="annotated-cell-19-55"><a href="#annotated-cell-19-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="16,17,18,19,20,21,22,23" data-code-annotation="1">å»ºç«‹æš«å­˜ç›®éŒ„ä¾†åœ¨ç¨å¾Œæ­¥é©Ÿç”¨ä¾†æ”¾æœ€æ–°ç‰ˆ Pester PowerShell moduleã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="24,25" data-code-annotation="2">ä½¿ç”¨ PowerShellGet çš„ <code>Save-Module</code> å‘½ä»¤å°‡æœ€æ–°ç‰ˆ Pester å¾ PowerShell Gallery ä¸‹è¼‰è‡³æš«å­˜ç›®éŒ„ï¼Œç„¶å¾Œç”¨ <code>Import-Module</code> è¼‰å…¥è©²ç‰ˆæœ¬çš„ Pester æ¨¡çµ„ã€‚(åƒè€ƒ<a href="https://pester.dev/docs/introduction/installation#installing-manually">å®˜æ–¹æ‰‹å‹•å®‰è£èªªæ˜æ–‡ä»¶</a>)</span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="27,28,29,30,31" data-code-annotation="3">å–å¾—ç›®å‰åŸ·è¡Œæ¸¬è©¦ç¨‹å¼çš„ç›®éŒ„ï¼Œä¸¦ä¸”è¨­å®šè¦åŸ·è¡Œçš„ Pester æ¸¬è©¦æ¡ˆä¾‹ script æª”æ¡ˆè·¯å¾‘ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="32,33" data-code-annotation="4">åŸ·è¡Œ Pester æ¸¬è©¦æ¡ˆä¾‹ script æª”æ¡ˆï¼Œä¸¦å°‡æ¸¬è©¦çµæœå›å‚³çµ¦ C# ç¨‹å¼ç¢¼ã€‚</span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="43,44,45,46" data-code-annotation="5">ç”±æ–¼ Pester æ¸¬è©¦çµæœå›å‚³çš„æ˜¯ PowerShell <a href="http://learn.microsoft.com/powershell/scripting/learn/deep-dives/everything-about-pscustomobject">PSCustomObject</a> å‹æ…‹ç‰©ä»¶ï¼Œæ‰€ä»¥é€é <code>Properties</code> å±¬æ€§ä¾†å–å¾—å„å€‹æ¸¬è©¦çµæœçš„å±¬æ€§å€¼ã€‚</span>
</dd>
</dl>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./04_AspNetCore_Host/pics/Invoke-Pester_test_result_object.png" class="quarto-figure quarto-figure-center" style="height:100.0%"></p>
</figure>
</div>
<p>å¦‚æ­¤æˆ‘å€‘å°±å¯ä»¥å°‡ PowerShell çš„ Pester å–®å…ƒæ¸¬è©¦æ•´åˆè‡³ xUnit æ¸¬è©¦å°ˆæ¡ˆä¸­ï¼Œè®“ Cï¼ƒ code &amp; PowerShell script ä¸€èµ·åŸ·è¡Œæ¸¬è©¦é©—è­‰ç¨‹å¼é‚è¼¯ã€‚ğŸ‘</p>
</section></section>
<section id="åƒè€ƒè³‡æ–™" class="title-slide slide level1 smaller scrollable center">
<h1>åƒè€ƒè³‡æ–™</h1>
<ul>
<li><a href="http://learn.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell">Differences between Windows PowerShell 5.1 and PowerShell 7.x</a></li>
<li>Udemy course <a href="https://www.udemy.com/course/powershell-for-sysadmins-getting-started/">PowerShell for Sysadmins: Getting Started (v7+)</a></li>
<li><strong>PowerShell Visual Studio code extension</strong> feature introduction:
<ul>
<li>Editing feature: <a href="https://devblogs.microsoft.com/scripting/visual-studio-code-editing-features-for-powershell-development-part-1/">&lt;part-1&gt;</a>, and <a href="https://devblogs.microsoft.com/scripting/visual-studio-code-editing-features-for-powershell-development-part-2/">&lt;part-2&gt;</a></li>
<li>Debugging feature: <a href="https://devblogs.microsoft.com/scripting/debugging-powershell-script-in-visual-studio-code-part-1/">&lt;part-1&gt;</a>, and <a href="https://devblogs.microsoft.com/scripting/debugging-powershell-script-in-visual-studio-code-part-2/">&lt;part-2&gt;</a></li>
<li><a href="https://learn.microsoft.com/powershell/utility-modules/psscriptanalyzer/using-scriptanalyzer?view=ps-modules#using-custom-rules-in-visual-studio-code">ScriptAnalyzer</a></li>
</ul></li>
<li>Three kinds of <a href="https://github.com/PoshCode/PowerShellPracticeAndStyle/discussions/177">PowerShell code formatting styles</a></li>
<li><strong>PowerShell.org</strong> Video:
<ul>
<li><a href="https://youtu.be/y1s2FnKrjxw?si=vn3Fl60ebbRH5W6Q">Writing Pester Tests at Scale by Jaap Brasser</a></li>
<li><a href="https://youtu.be/q88Aq9suw2w?si=1II3rnDerFS65gcQ">Mastering Pester: PowerShell Unit and Infrastructure Testing by Jaap Brasser, Justin Grote</a></li>
</ul></li>
<li><strong>PowerShell Conference EU</strong> Video:
<ul>
<li><a href="https://youtu.be/_Hr6CeTKbLc?si=_cUU5ESn6BCxgxYa">Modern PowerShell module Development - Gael Colas - PSConfEU 2024</a></li>
<li><a href="https://youtu.be/6jQqf-LTRGI?si=mea7Y9MBJOu7KGRw">Creating your first PowerShell module in C# - Emanuel Palm,Justin Grote - PSConfEU 2023</a></li>
<li><a href="https://youtu.be/3PmJUk7gzpE?si=_Npq_o_nJCe11j9v">Get Started with AI assisted PowerShell coding. - Pierre Roman - PSConfEU 2023</a></li>
</ul></li>
<li><a href="http://learn.microsoft.com/powershell/scripting/dev-cross-plat/vscode/using-vscode-for-debugging-compiled-cmdlets">Using Visual Studio Code to debug compiled cmdlets</a></li>
<li><a href="https://devblogs.microsoft.com/dotnet/grpc-web-experiment/">gRPC-Web in .NET</a></li>
<li><a href="https://code-maze.com/csharp-run-powershell-script/">Execute a PowerShell Script in C#</a></li>
<li><strong>Using the PowerShell API from .NET</strong>
<ul>
<li><a href="https://youtu.be/GI5Y0ldHyac?si=aehQA_AHAqaCytdK">YouTubeå½±ç‰‡</a></li>
<li><a href="https://gist.github.com/rjmholt/7c1072a24a51e7b43d1e7df02265fe18">æ•™å­¸æ–‡ä»¶</a></li>
</ul></li>
<li>Beginning Use of PowerShell Runspaces: <a href="https://devblogs.microsoft.com/scripting/beginning-use-of-powershell-runspaces-part-1/">Part 1</a> &amp; <a href="https://devblogs.microsoft.com/scripting/beginning-use-of-powershell-runspaces-part-2/">Part 2</a> &amp; <a href="https://devblogs.microsoft.com/scripting/beginning-use-of-powershell-runspaces-part-3/">Part 3</a></li>
<li><a href="https://www.hans-eric.com/2022/07/12/powershell-tdd-testing-shouldprocess/">PowerShell TDD: Testing ShouldProcess</a></li>
<li><a href="https://adamtheautomator.com/powershell-validatescript/">Mastering PowerShell ValidateScript for Better Input</a></li>
<li><a href="https://mikefrobbins.com/2018/04/26/simplifying-parameter-validation-in-powershell-with-private-functions/">Simplifying Parameter Validation in PowerShell with Private Functions</a></li>
</ul>
</section>

<section id="q-a" class="title-slide slide level1 center-xy center">
<h1>Q &amp; A</h1>
<p>Any Questions?ğŸ™‹â€â™‚ï¸ğŸ™‹â€â™€ï¸</p>

</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"right","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1300,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
          let selectedAnnoteEl;
          const selectorForAnnotation = ( cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' +  annotation + '"';
            const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
            return selector;
          }
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
            const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            })
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
                //compute the position of the single el (top and bottom and make a div)
                const el = window.document.getElementById(lineIds[0]);
                top = el.offsetTop;
                height = el.offsetHeight;
                parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it 
                let div = window.document.getElementById("code-annotation-line-highlight");
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = 'absolute';
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                  gutterDiv.style.position = 'absolute';
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector('.code-annotation-gutter');
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
          // Attach click handler to the DT
          const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
          for (const annoteDlNode of annoteDls) {
            annoteDlNode.addEventListener('click', (event) => {
              const clickedEl = event.target;
              if (clickedEl !== selectedAnnoteEl) {
                unselectCodeLines();
                const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
                if (activeEl) {
                  activeEl.classList.remove('code-annotation-active');
                }
                selectCodeLines(clickedEl);
                clickedEl.classList.add('code-annotation-active');
              } else {
                // Unselect the line
                unselectCodeLines();
                clickedEl.classList.remove('code-annotation-active');
              }
            });
          }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>