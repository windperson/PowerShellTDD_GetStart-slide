
## VSCode as PowerShell TDD IDE

* å»ºè­°ä½¿ç”¨ [**VSCode**(Visual Studio Code)](http://code.visualstudio.com) å®‰è£å®˜æ–¹ [PowerShell Extension](http://github.com/PowerShell/vscode-powershell) + C# ç›¸é—œé–‹ç™¼æ“´å……å¥—ä»¶ ä½œç‚º PowerShell é–‹ç™¼ç’°å¢ƒ:
  * å®˜æ–¹å®‰è£è¨­å®šæ•™å­¸ï¼š <br/>
    * <https://code.visualstudio.com/docs/languages/powershell>
    * <https://learn.microsoft.com/powershell/scripting/dev-cross-plat/vscode/using-vscode>
  * æä¾› PowerShell çš„ Syntax Highlightingã€Outline Viewã€Go to Definitionã€IntelliSenseã€Code Lensã€Run & Debug Pester test code ç­‰åŠŸèƒ½ã€‚
  * å¯ debug PowerShell + C# binary cmdlet çš„æ··åˆå°ˆæ¡ˆã€‚

## VSCode as PowerShell TDD IDE

* ç‚ºäº†æœ‰ä¸€å€‹ä¹¾æ·¨ï¼†å¿«é€Ÿçš„TDDé–‹ç™¼ç’°å¢ƒï¼Œå»ºè­°ä½¿ç”¨[ Portable ç‰ˆæœ¬çš„ VSCode](http://code.visualstudio.com/docs/editor/portable)ï¼Œä»¥å…åŒæ™‚å®‰è£å¤ªå¤šæ“´å……å¥—ä»¶æ¶ˆè€—è³‡æºã€‚

* ä¸€å®šè¦å®‰è£çš„å¥—ä»¶å…¶å¯¦åªæœ‰ä¸‰å€‹(å»æ‰ Vim ğŸ˜†)ï¼š<br/>
([C# Dev Kit](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csdevkit)å¥—ä»¶éå…è²»ä¸”ç„¡æ³•åœ¨å°é–‰å…§ç¶²ç’°å¢ƒä½¿ç”¨)

![]({{< meta part1_img_prefix >}}pics/minimal_powershell_dev_extensions.png){fig-align="center"}

## Example VSCode Environment

ç”±æ–¼ .NET SDK æœƒæ ¹æ“šä½œæ¥­ç³»çµ±ï¼†CPUæ¶æ§‹ä¸åŒè€Œæœ‰ä¸åŒçš„å®‰è£æ–¹å¼ï¼Œæä¾›ä»¥ä¸‹ç‰ˆæœ¬çš„ Portable VSCode + PowerShell Extension + C# ç›¸é—œé–‹ç™¼æ“´å……å¥—ä»¶ çš„ç¯„ä¾‹é–‹ç™¼ç’°å¢ƒï¼š

* [Windows 10 & 11 (x64)](https://github.com/windperson/vscode_win32x64_pwsh)
* [Windows 11 (ARM64)](https://github.com/windperson/vscode_win32Arm64_pwsh)
* [[TBD]macOS (ARM 64)]()
* [[TBD]Linux (x64)]()

## Example VSCode Environment - Windows(x64) {.scrollable}


é™¤äº†è¦æ‰‹å‹•é–‹å•ŸWindowsã€é–‹ç™¼è€…æ¨¡å¼ã€è¨­å®šä»¥åŠå°‡åŒæ†çš„ .NET SDK çš„åŸ·è¡Œæª”è·¯å¾‘åˆ°ç’°å¢ƒè®Šæ•¸ä¹‹å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä½¿ç”¨ Portable ç‰ˆæœ¬çš„é–‹ç™¼ç’°å¢ƒï¼š

* Windows ç’°å¢ƒçš„ relative symbolic link éœ€è¦å•Ÿç”¨é–‹ç™¼è€…æ¨¡å¼æ‰èƒ½è®“ PowerShell ä»¥ä¸éœ€ç®¡ç†å“¡æ¬Šé™çš„æ–¹å¼è¨­å®šã€‚
   ![]({{< meta part1_img_prefix >}}pics/win10_developer_mode.png){fig-align="center"}  
   å¦å‰‡ç”šè‡³é€£Windowså…§å»ºçš„è§£å£“ç¸®åŠŸèƒ½éƒ½æœƒè¢«æ‹’çµ•å­˜å–ã€‚
   ![]({{< meta part1_img_prefix >}}pics/symbolic_link_no_permission.png){fig-align="center"}
* .NET SDK çš„åŸ·è¡Œè·¯å¾‘å»ºè­°ä»¥ **DOTNET_ROOT** ç’°å¢ƒè®Šæ•¸è¨­å®šï¼Œä»¥ä¾¿æ–¼åˆ‡æ›ä¸åŒç‰ˆæœ¬çš„ dotnet æŒ‡ä»¤<br/>ï¼ˆä½¿ç”¨ç³»çµ±å®‰è£çš„ .NET SDK 8.0 ä¹ŸğŸ‘ŒğŸ†—ï¼‰ã€‚
   ![]({{< meta part1_img_prefix >}}pics/set_dotnet_root_env-Windows_x64.png){fig-align="center"}
   ![]({{< meta part1_img_prefix >}}pics/set_path_env_include_dotnet_root-Windows_x64.png){fig-align="center"}

## Example VSCode Environment - Windows(x64) {.scrollable}

é–‹ç™¼ç’°å¢ƒçš„æª”æ¡ˆç›®éŒ„æ¶æ§‹:

![]({{< meta part1_img_prefix >}}pics/portable_vscode_ide_files.png){width=80% height=80% fig-align="center"}

* ä½¿ç”¨ç¨ç«‹çš„ PowerShell Module ç›®éŒ„é¿å…å› ç‚ºä¸åŒå°ˆæ¡ˆéœ€è¦çš„å„ç¨®ç‰ˆæœ¬ PowerShell Module äº’è¡ï¼Œæˆ–æ˜¯å’Œç³»çµ±å±¤ç´šçš„ Module æ··æ·†ã€‚

* å› æ­¤è¦åœ¨ PowerShell Module ç›®éŒ„å…§ä¸‹è¼‰ä¸¦å®‰è£ ["ModuleFast"](https://github.com/JustinGrote/ModuleFast) é€™å€‹å·¥å…·å‹ PowerShell Moduleï¼Œç”¨æ­¤å‘½ä»¤åˆ—å·¥å…·å®‰è£ PowerShell Module æ™‚å¯ä¸‹æŒ‡ä»¤æŒ‡å®šå®‰è£ä¾†æºã€å®‰è£ä½ç½®ã€æ¨¡çµ„ç‰ˆæœ¬ã€‚ 

ä¾‹å¦‚ä»¥ä¸‹ç¯„ä¾‹ï¼Œå¾ nuget.org å®‰è£ Pester v5.6.1 ç‰ˆæœ¬åˆ° D:\vscode_portable\pwsh_modules ç›®éŒ„ï¼š
```powershell
 @{ModuleName='Pester';ModuleVersion='5.6.1'} | Install-ModuleFast -Source api.nuget.org/v3 -Destination D:\vscode_portable\pwsh_modules
```

<br/>
å¦å¤–é‚„æœ‰ä¸€å€‹å¥½ç”¨çš„é–‹ç™¼ç”¨ PowerShell æŒ‡ä»¤åˆ—å·¥å…·æ¨¡çµ„ [PowerShell.dumPS](http://github.com/deadlydog/PowerShell.dumPS)ï¼Œå¯ä»¥ç”¨ä¾†åœ¨ VSCode ä¸­æ–·é»é™¤éŒ¯æ™‚ï¼Œä½¿ç”¨ Debug Console å¿«é€ŸæŸ¥çœ‹ PowerShell ç‰©ä»¶çš„é¡åˆ¥ã€å±¬æ€§å€¼è³‡è¨Šã€‚

```powershell
$AnyObject | Out-Dump
```

![]({{< meta part1_img_prefix >}}pics/demo_PowerShell.dumPS.png){fig-align="center"}

## Example VSCode Environment - Windows(x64) {.scrollable}

åœ¨ pwsh-scripts ç›®éŒ„çš„é–‹ç™¼ç’°å¢ƒè¨­å®šç”¨ script æª”æ¡ˆï¼š

* **PSScriptAnalyzerSettings.psd1**<br/>ç”¨ä¾†æ§åˆ¶ VSCode å®˜æ–¹ PowerShell Extension å…§å»ºçš„ [PSScriptAnalyzer(PowerShell Syntax Linter)](https://learn.microsoft.com/powershell/utility-modules/psscriptanalyzer/using-scriptanalyze) è¨­å®šæª”ã€‚ 
* **Set-PwshTools.ps1**<br/>æ›¿ä»£ PowerShell Profile çš„è¨­å®šæª”ï¼Œç”¨ä¾†è¨­å®š VSCode æ•´åˆçµ‚ç«¯æ©Ÿä¸­ PowerShell å‘½ä»¤åˆ—çš„è‡ªå‹•å®ŒæˆåŠŸèƒ½ç›¸é—œè¨­å®šä»¥åŠæ·»åŠ ä¸€äº›é¡ä¼¼ Unix ç’°å¢ƒçš„æª”æ¡ˆå‘½ä»¤ã€‚

```json
  "terminal.integrated.profiles.windows": {
    "PowerShell": {
      "title": "Bundled pwsh",
      "path": "D:\\vscode_portable\\PowerShell-x64\\pwsh.exe",
      "args": [
        "-nol",
        "-nop",                                                                         // <1>
        "-noe",
        "-ex",
        "RemoteSigned",
        "-Command",                                                                     // <2>
        "Invoke-expression \". D:\\vscode_portable\\pwsh-scripts\\Set-PwshTools.ps1\""  // <2>
      ]
    }
  },
```
1. ä½¿ç”¨ `-nop` åƒæ•¸é¿å…åŸ·è¡Œç›®å‰ç³»çµ±/ä½¿ç”¨è€…ç­‰ç´šçš„ PowerShell Profile è¨­å®šæª”
2. åŸ·è¡Œ `Invoke-Expression ". D:\vscode_portable\pwsh-scripts\Set-PwshTools.ps1"` ä¾†æ›¿ä»£ã€‚

* **Update-SymLinks.ps1**<br/>ç”¨ä¾†æ›´æ–°/æ¢å¾©å…©å€‹ symbolic link æª”æ¡ˆï¼1. æ ¹ç›®éŒ„çš„ VSCode ä¸»ç¨‹å¼å•Ÿå‹•é€£çµ 2. VSCode å¯æ”œæ¨¡å¼è¨­å®šçš„ä½¿ç”¨è€…è³‡æ–™æª”æ¡ˆç›®éŒ„é€£çµã€‚<br/>(Windows 10 symbolic link æœƒå› æ¬ç§»åˆ°ä¸åŒç£ç¢Ÿæ©Ÿ/é›»è…¦è€Œå¤±æ•ˆ)
